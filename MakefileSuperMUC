# -DMPI selects MPI.
# -DSTAB1  Alternative stabilization, using the singular value decomposition.
# -DSTAB2  Alternative stabilization, lapack QR with  manual pivoting. Packed form of QR factorization is not used.
# (Noflag) Default  stabilization, using lapack QR with pivoting. Packed form of QR factorization  is used. 
# -DQRREF  Enables reference lapack implementation of QR decomposition.
# -DTEMPERING  Complies program for parallel tempering. Requires MPI
# Recommendation:  just use the -DMPI flag if you want to run in parallel or leave it empy for serial jobs.  
# The default stabilization, no flag, is generically the best. 

#LRZ enviroment
module switch mpi.ibm mpi.intel
module switch intel intel/17.0
module switch mkl mkl/2017
export f90=mpif90

# use the appropriate flags as explained above
PROGRAMMCONFIGURATION= -DMPI

# add (remove) "-parallel -qopenmp" in the next line if you (don't) want to use additional openmp parallelization
F90OPTFLAGS="-O3 -fp-model fast=2 -xHost -unroll -finline-functions -ipo -ip -heap-arrays 1024 -no-wrap-margin -parallel -qopenmp"
F90USEFULFLAGS="-cpp"
export F90USEFULFLAGS
export F90OPTFLAGS

FL="-c ${F90OPTFLAGS} ${PROGRAMMCONFIGURATION}"
export FL

export Libs=${DIR}"/Libraries/"
export LIB_BLAS_LAPACK=$MKL_LIB

.phony: all lib ana program  Hub_Ising SPT Hub Hub_Can Kondo_Honey
all: lib ana program  Hub_Ising SPT Hub Hub_Can Kondo_Honey

lib:
	cd Libraries && $(MAKE)
ana:
	cd Analysis && $(MAKE)
program:
	cd Prog && $(MAKE) Examples
Hub_Ising:
	cd Prog && $(MAKE) Hub_Ising
SPT:
	cd Prog && $(MAKE) SPT
Hub:
	cd Prog && $(MAKE) Hub
Hub_Can:
	cd Prog && $(MAKE) Hub_Can
Kondo_Honey:
	cd Prog && $(MAKE) Kondo_Honey

.phony: clean cleanall cleanprog cleanlib cleanana help
clean: cleanall
cleanall: cleanprog cleanlib cleanana  
cleanprog:
	cd Prog && $(MAKE) clean 
cleanlib:
	cd Libraries && $(MAKE) clean
cleanana:
	cd Analysis && $(MAKE) clean
help:
	@echo "The following are some of the valid targets of this Makefile"
	@echo "all, program, lib, ana, clean, cleanall, cleanprog, cleanlib, cleanana"
	@echo "Hub_Ising SPT Hub Hub_Can Kondo_Honey"
