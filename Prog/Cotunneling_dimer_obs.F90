! This file is included by Predefined_Obs_mod.F90

!-------------------------------------------------------------------
!> @author
!> ALF-project
!
!>  @brief
!>  K_{i,m} =  \sum{\alpha,\sigma} c^{\dagger}_{i,\alpha,sigma}  c_{m,\alpha, sigma}   + H.c.
!>  The routine returns 
!>       << K_{i,m}   >>
!>  If N_FL  (\alpha)   and  N_SUN (\sigma)  can take  any values 
!--------------------------------------------------------------------
      Complex (Kind=Kind(0.d0)) function Predefined_Obs_dimer_kin0_eq(I,M, GR, N_SUN, N_FL)
  
        Implicit none
        
        Integer, Intent(IN)        ::  I,M, N_SUN, N_FL
        Complex (Kind=Kind(0.d0)), Dimension(:,:,:), INTENT(IN) :: GR 
        Complex (Kind=Kind(0.d0))  ::  Z, ZK, ZN
        Integer                    ::  nf

        Z  = cmplx(0.d0,0.d0,Kind(0.d0))
        ZK = cmplx(0.d0,0.d0,kind(0.d0))
        if ( I == M ) ZK = cmplx(1.d0,0.d0,kind(0.d0))
        ZN = cmplx(Real(N_SUN,Kind(0.d0)),0.d0,Kind(0.d0))
        do nf =  1, N_FL
           Z  = ZN  *   ( 2.d0*ZK - GR(I,M,nf)  -  GR(M,I,nf) )
        enddo

        Predefined_Obs_dimer_kin0_eq = Z
        
      end function Predefined_Obs_dimer_kin0_eq

 !-------------------------------------------------------------------
!> @author
!> ALF-project
!
!>  @brief
!>  K_{i,m} =  \sum{\alpha,\sigma} c^{\dagger}_{i,\alpha,sigma}  c_{m,\alpha, sigma}   + H.c.
!>  The routine returns 
!>       << K_{i,m}  K_{j,n}   >>
!>  If N_FL  (\alpha)   and  N_SUN (\sigma)  can take  any values 
!--------------------------------------------------------------------
      Complex (Kind=Kind(0.d0)) function Predefined_Obs_dimer_kin_eq(I,M, J, N,  GR, GRC,  N_SUN, N_FL)
  
        Implicit none
        
        Integer, Intent(IN)        ::  I,M, J, N, N_SUN, N_FL
        Complex (Kind=Kind(0.d0)), Dimension(:,:,:), INTENT(IN) :: GR,  GRC 
        Complex (Kind=Kind(0.d0))  ::  Z, ZK, ZN
        Integer                    ::  nf

        Z  = cmplx(0.d0,0.d0,Kind(0.d0))
        ZK = cmplx(0.d0,0.d0,kind(0.d0))
        if ( I == M ) ZK = cmplx(1.d0,0.d0,kind(0.d0))
        ZN = cmplx(Real(N_SUN,Kind(0.d0)),0.d0,Kind(0.d0))
        do nf =  1, N_FL
           Z  =     ZN * ZN* (GRC(I,M,nf) +   GRC(M,I,nf))*  (GRC(J,N,nf) +   GRC(N,J,nf)) + &
                &   ZN *  (   GRC(I,N,nf)* GR(M,J,nf)  + GRC(I,J,nf) *GR(M,N,nf) + &
                &             GRC(M,N,nf)* GR(I,J,nf)  + GRC(M,J,nf) *GR(I,N,nf)    )
        enddo

        Predefined_Obs_dimer_kin_eq = Z
        
      end function Predefined_Obs_dimer_kin_eq
     
!-------------------------------------------------------------------
!> @author
!> ALF-project
!
!>  @brief
!>  Let   S^{alpha}_{beta}(i)   =   c^{\dagger}_{\alpha}  c_{\beta}   - \delta{\alpha,\beta}/2 
!>  The routine returns 
!>       << S^{alpha}_{beta}(i)  S^{beta}_{alpha}(m)  >>
!>  If N_FL = 1 then N_SUN can take any value.
!>  If N_FL = 2 then N_SUN = 1 
!--------------------------------------------------------------------

      Complex (Kind=Kind(0.d0)) function Predefined_Obs_dimer0_eq(I,M, GR, N_SUN, N_FL)
  
        USE runtime_error_mod 
        Implicit none
        
        Integer, Intent(IN)        ::  I,M, N_SUN, N_FL
        Complex (Kind=Kind(0.d0)), Dimension(:,:,:), INTENT(IN) :: GR 
        Complex (Kind=Kind(0.d0))  ::  Z, ZK, ZN

        Z = cmplx(0.d0,0.d0,Kind(0.d0))
        ZK = cmplx(0.d0,0.d0,kind(0.d0))
        if ( I == M ) ZK = cmplx(1.d0,0.d0,kind(0.d0))
        ZN = cmplx(Real(N_SUN,Kind(0.d0)),0.d0,Kind(0.d0))
        if (N_FL == 1 ) then
           Z  = ZN  *  ( 0.5d0  - GR(I,I,1) ) * (  0.5D0 - GR(M,M,1) )  + &
                &   ZN*ZN* (ZK  - GR(M,I,1))*GR(I,M,1)
        elseif (N_FL == 2)  then  ! N_SUN = 1
           Z  =  ( 0.5d0  - GR(I,I,1) ) * (  0.5D0 - GR(M,M,1) )  + &
              &  ( 0.5d0  - GR(I,I,2) ) * (  0.5D0 - GR(M,M,2) )  + &
              &  ( 2.d0*ZK - GR(M,I,1)  - GR(M,I,2)  ) *  ( GR(I,M,1)  + GR(I,M,2))
        endif

        Predefined_Obs_dimer0_eq = Z
        
      end function Predefined_Obs_dimer0_eq
 
!-------------------------------------------------------------------
!> @author
!> ALF-project
!
!>  @brief
!>  Let   S^{alpha}_{beta}(i)   =   c^{\dagger}_{\alpha}  c_{\beta}   - \delta{\alpha,\beta}/2 
!>  The routine returns 
!>       << S^{alpha}_{beta}(i)  S^{beta}_{alpha}(m)  S^{delta}_{gamma}(j)  S^{gamma}_{delta}(n)>>
!>  If N_FL = 1 then N_SUN can take any value.
!>  If N_FL = 2 then N_SUN = 1 
!--------------------------------------------------------------------
      Complex (Kind=Kind(0.d0)) function Predefined_Obs_dimer_eq(I,M,J,N, GR, GRC, N_SUN, N_FL) 
          
        USE runtime_error_mod
        Implicit none
        
        Integer, Intent(IN) ::  I,M,J, N, N_SUN, N_FL
        Complex (Kind=Kind(0.d0)), Dimension(:,:,:), INTENT(IN) :: GR,GRC
        
        
        ! local
        Complex (Kind=Kind(0.d0)) ::  G(4,4),  Z_res, G1(4,4,2)
        Integer ::  ns
        
        
        !Wick decomp is carried out with Mathematica. See  notebooks:  $ALF/Mathematica/Dimer-Dimer_SU2_NFL_2.nb
        ! and $ALF/Mathematica/Dimer-Dimer_SUN_NFL_1.nb 
        Z_res = cmplx(0.d0,0.d0,Kind(0.d0))

        If (N_FL == 1) then
           G(1,1)=   grc(i,i,1); G(1,2)= grc(i,m,1); G(1,3)= grc(i,j,1); G(1,4)= grc(i,n,1)
           G(2,1)=  -gr(i,m,1) ; G(2,2)= grc(m,m,1); G(2,3)= grc(m,j,1); G(2,4)= grc(m,n,1)
           G(3,1)=  -gr(i,j,1) ; G(3,2)= -gr(m,j,1); G(3,3)= grc(j,j,1); G(3,4)= grc(j,n,1)
           G(4,1)=  -gr(i,n,1) ; G(4,2)= -gr(m,n,1); G(4,3)= -gr(j,n,1); G(4,4)= grc(n,n,1)
           select Case(N_SUN)
           case(2)           
              Z_res =  (1.0 - 2.0*G(1,3)*G(3,1) + G(2,2)*(-2.0 + 4.0*G(1,3)*G(3,1)) - 2.0*G(3,3) -  &
                   &  2.0*G(1,4)*G(4,1) + 4.0*G(2,2)*(G(3,3) + G(1,4)*G(4,1)) +                   &
                   &  2.0*(2.0*G(1,4)*G(3,3)*G(4,1) - 4.0*G(1,4)*G(2,2)*G(3,3)*G(4,1) -           &
                   &  4.0*G(1,4)*G(2,1)*G(4,2) - G(2,4)*G(4,2) +                                  &
                   &  8.0*G(1,4)*G(2,1)*G(3,3)*G(4,2) + 2.0*G(2,4)*G(3,3)*G(4,2) +                &
                   &  G(2,3)*(G(3,2)*(-1.0 + 8.0*G(1,4)*G(4,1)) -                                 &
                   &  4.0*(G(1,4)*G(3,1) + G(3,4))*G(4,2)) -                                      &
                   &  4.0*G(1,3)*((G(2,4)*G(3,2) + G(3,4) - 2.0*G(2,2)*G(3,4))*G(4,1) -           &
                   &  2.0*G(2,4)*G(3,1)*G(4,2) + G(2,1)*(G(3,2) + 4.0*G(3,4)*G(4,2))) -           &
                   &  4.0*(G(2,4)*G(3,2) + G(1,4)*                                                &
                   &  (G(3,1) - 2.0*G(2,2)*G(3,1) + 4.0*G(2,1)*G(3,2)) + G(3,4) -                 &
                   &  2.0*G(2,2)*G(3,4))*G(4,3)) - 2.0*G(4,4) +                                   &
                   &  4.0*(G(2,3)*G(3,2) + G(1,3)*(G(3,1) + 4.0*G(2,1)*G(3,2)) +                  &
                   &  G(2,2)*(1.0 - 2*G(1,3)*G(3,1) - 2.0*G(3,3)) + G(3,3))*G(4,4) -              &
                   &  8.0*G(1,2)*(G(2,4)*(G(4,1) - 2.0*G(3,3)*G(4,1) + 4.0*G(3,1)*G(4,3)) +       &
                   &  G(2,3)*(G(3,1) + 4.0*G(3,4)*G(4,1) - 2.0*G(3,1)*G(4,4)) +                     &
                   &  G(2,1)*(1.0 - 8.0*G(3,4)*G(4,3) - 2.0*G(4,4) + G(3,3)*(-2.0+4.0*G(4,4))))  +  &
                   &  2.0*G(1,1)*(-((-1.0 + 2.0*G(3,3))*(-1.0 + 2.0*G(2,4)*G(4,2))) + 2.0*G(4,4)  + &
                   &  2.0*G(2,2)*(1.0 - 8.0*G(3,4)*G(4,3) - 2.0*G(4,4) + G(3,3)*(-2.0+4.0*G(4,4)))+ &
                   &  2.0*(4.0*(G(2,4)*G(3,2) + G(3,4))*G(4,3) - 2.0*G(3,3)*G(4,4) +                &
                   &  G(2,3)*(G(3,2) + 4.0*G(3,4)*G(4,2) - 2.0*G(3,2)*G(4,4)))))/4.0
           case(4)
              Z_res  =    +  1.0 - 2.*G(2,2) - G(1,3)*G(3,1) + 2.*G(1,3)*G(2,2)*G(3,1) -  &
                   &   8.*G(1,3)*G(2,1)*G(3,2) - G(2,3)*G(3,2) - 2.*G(3,3) + 4.*G(2,2)*G(3,3) - &
                   &   G(1,4)*G(4,1) + 2.*G(1,4)*G(2,2)*G(4,1) + 16.*G(1,4)*G(2,3)*G(3,2)*G(4,1) -   &
                   &   4.*G(1,3)*G(2,4)*G(3,2)*G(4,1) + 2.*G(1,4)*G(3,3)*G(4,1) -  &
                   &   4.*G(1,4)*G(2,2)*G(3,3)*G(4,1) - 8.*G(1,3)*G(3,4)*G(4,1) +  &
                   &   16.*G(1,3)*G(2,2)*G(3,4)*G(4,1) - 8.*G(1,4)*G(2,1)*G(4,2) - G(2,4)*G(4,2) -  &
                   &   4.*G(1,4)*G(2,3)*G(3,1)*G(4,2) + 16.*G(1,3)*G(2,4)*G(3,1)*G(4,2) + &
                   &   16.*G(1,4)*G(2,1)*G(3,3)*G(4,2) + 2.*G(2,4)*G(3,3)*G(4,2) -   &
                   &   64.*G(1,3)*G(2,1)*G(3,4)*G(4,2) - 8.*G(2,3)*G(3,4)*G(4,2) -  &
                   &   8.*G(1,4)*G(3,1)*G(4,3) + 16.*G(1,4)*G(2,2)*G(3,1)*G(4,3) -  &
                   &   64.*G(1,4)*G(2,1)*G(3,2)*G(4,3) - 8.*G(2,4)*G(3,2)*G(4,3) -   &
                   &   16.*G(3,4)*G(4,3) + 32.*G(2,2)*G(3,4)*G(4,3) +  &
                   &   2.*(-1. + G(2,3)*G(3,2) + G(1,3)*(G(3,1) + 8.*G(2,1)*G(3,2)) + 2.*G(3,3) -  &
                   &   2.*G(2,2)*(-1. + G(1,3)*G(3,1) + 2.*G(3,3)))*G(4,4) -   &
                   &   8.*G(1,2)*(G(2,4)*(G(4,1) - 2.*G(3,3)*G(4,1) + 8.*G(3,1)*G(4,3)) +  &
                   &   G(2,3)*(G(3,1) + 8.*G(3,4)*G(4,1) - 2.*G(3,1)*G(4,4)) +  &
                   &   G(2,1)*(2. - 32.*G(3,4)*G(4,3) - 4.*G(4,4) + G(3,3)*(-4. + 8.*G(4,4)))) +  &
                   &   2.*G(1,1)*(-((-1. + 2.*G(3,3))*(-1. + G(2,4)*G(4,2))) +   &
                   &   8.*(G(2,4)*G(3,2) + 2.*G(3,4))*G(4,3) +   G(2,3)*(8.*G(3,4)*G(4,2) + &
                   &   G(3,2)*(1. - 2.*G(4,4))) + 2.*G(4,4) - 4.*G(3,3)*G(4,4) + G(2,2)* &
                   &   (2. - 32.*G(3,4)*G(4,3) - 4.*G(4,4) +   G(3,3)*(-4. + 8.*G(4,4))))
           case (6)
              Z_res  =   (3*(3 - 2*G(1,3)*G(3,1) + G(2,2)*(-6 + 4*G(1,3)*G(3,1)) -  &
                   &      2*(12*G(1,3)*G(2,1) + G(2,3))*G(3,2) - 6*G(3,3) - 2*G(1,4)*G(4,1) + &
                   &      4*(G(1,4)*(12*G(2,3)*G(3,2) + (1 - 2*G(2,2))*G(3,3)) - &
                   &      2*G(1,3)*(G(2,4)*G(3,2) + 3*(1 - 2*G(2,2))*G(3,4)))*G(4,1) + &
                   &      4*G(2,2)*(3*G(3,3) + G(1,4)*G(4,1)) + &
                   &      2*(-4*G(1,4)*(G(2,3)*G(3,1) + G(2,1)*(3 - 6*G(3,3))) + &
                   &      G(2,4)*(-1 + 24*G(1,3)*G(3,1) + 2*G(3,3)) - &
                   &      12*(12*G(1,3)*G(2,1) + G(2,3))*G(3,4))*G(4,2) - &
                   &      24*(G(2,4)*G(3,2) + G(1,4)* &
                   &      ((1 - 2*G(2,2))*G(3,1) + 12*G(2,1)*G(3,2)) + &
                   &      3*(1 - 2*G(2,2))*G(3,4))*G(4,3) - 6*G(4,4) + &
                   &      4*(G(2,3)*G(3,2) + G(1,3)*(G(3,1) + 12*G(2,1)*G(3,2)) + &
                   &      G(2,2)*(3 - 2*G(1,3)*G(3,1) - 6*G(3,3)) + 3*G(3,3))*G(4,4) - &
                   &      24*G(1,2)*(G(2,4)*(G(4,1) - 2*G(3,3)*G(4,1) + 12*G(3,1)*G(4,3)) + &
                   &      G(2,3)*(G(3,1) + 12*G(3,4)*G(4,1) - 2*G(3,1)*G(4,4)) + &
                   &      3*G(2,1)*(1 - 24*G(3,4)*G(4,3) - 2*G(4,4) + &
                   &      G(3,3)*(-2 + 4*G(4,4)))) +  &
                   &      2*G(1,1)*(-((-1 + 2*G(3,3))*(-3 + 2*G(2,4)*G(4,2))) + &
                   &      24*(G(2,4)*G(3,2) + 3*G(3,4))*G(4,3) + &
                   &      2*G(2,3)*(12*G(3,4)*G(4,2) + G(3,2)*(1 - 2*G(4,4))) + 6*G(4,4) - &
                   &      12*G(3,3)*G(4,4) + 6*G(2,2)*&
                   &      (1 - 24*G(3,4)*G(4,3) - 2*G(4,4) + G(3,3)*(-2 + 4*G(4,4))))))/4.
           case(8)
              Z_res = 2*(2 - 4*G(2,2) - G(1,3)*G(3,1) + 2*G(1,3)*G(2,2)*G(3,1) - &
                   &    16*G(1,3)*G(2,1)*G(3,2) - G(2,3)*G(3,2) - 4*G(3,3) + 8*G(2,2)*G(3,3) - &
                   &    G(1,4)*G(4,1) + 2*G(1,4)*G(2,2)*G(4,1) + &
                   &    32*G(1,4)*G(2,3)*G(3,2)*G(4,1) - 4*G(1,3)*G(2,4)*G(3,2)*G(4,1) + &
                   &    2*G(1,4)*G(3,3)*G(4,1) - 4*G(1,4)*G(2,2)*G(3,3)*G(4,1) - &
                   &    16*G(1,3)*G(3,4)*G(4,1) + 32*G(1,3)*G(2,2)*G(3,4)*G(4,1) - &
                   &    16*G(1,4)*G(2,1)*G(4,2) - G(2,4)*G(4,2) - &
                   &    4*G(1,4)*G(2,3)*G(3,1)*G(4,2) + 32*G(1,3)*G(2,4)*G(3,1)*G(4,2) + &
                   &    32*G(1,4)*G(2,1)*G(3,3)*G(4,2) + 2*G(2,4)*G(3,3)*G(4,2) - &
                   &    256*G(1,3)*G(2,1)*G(3,4)*G(4,2) - 16*G(2,3)*G(3,4)*G(4,2) - &
                   &    16*G(1,4)*G(3,1)*G(4,3) + 32*G(1,4)*G(2,2)*G(3,1)*G(4,3) - &
                   &    256*G(1,4)*G(2,1)*G(3,2)*G(4,3) - 16*G(2,4)*G(3,2)*G(4,3) - &
                   &    64*G(3,4)*G(4,3) + 128*G(2,2)*G(3,4)*G(4,3) + &
                   &    2*(-2 + G(2,3)*G(3,2) + G(1,3)*(G(3,1) + 16*G(2,1)*G(3,2)) + &
                   &    4*G(3,3) - 2*G(2,2)*(-2 + G(1,3)*G(3,1) + 4*G(3,3)))*G(4,4) - &
                   &    16*G(1,2)*(G(2,4)*(G(4,1) - 2*G(3,3)*G(4,1) + 16*G(3,1)*G(4,3)) + &
                   &    G(2,3)*(G(3,1) + 16*G(3,4)*G(4,1) - 2*G(3,1)*G(4,4)) + &
                   &    4*G(2,1)*(1 - 32*G(3,4)*G(4,3) - 2*G(4,4) + G(3,3)*(-2 + 4*G(4,4)))) + &
                   &    2*G(1,1)*(-((-1 + 2*G(3,3))*(-2 + G(2,4)*G(4,2))) +  &
                   &    16*(G(2,4)*G(3,2) + 4*G(3,4))*G(4,3) + &
                   &    G(2,3)*(16*G(3,4)*G(4,2) + G(3,2)*(1 - 2*G(4,4))) + 4*G(4,4) - &
                   &    8*G(3,3)*G(4,4) + 4*G(2,2)*&
                   &    (1 - 32*G(3,4)*G(4,3) - 2*G(4,4) + G(3,3)*(-2 + 4*G(4,4)))))
           case  default
              Write(error_unit,*) 'Dimer, N_SUN=', N_SUN, 'is not yet implemented'
              CALL Terminate_on_error(ERROR_MISSING_OBS,__FILE__,__LINE__)
           end select
        elseif(N_FL == 2 ) then  !  This only works for N_SUN = 1
           do ns = 1,2
              G1(1,1,ns)=   grc(i,i,ns); G1(1,2,ns)= grc(i,m,ns); G1(1,3,ns)= grc(i,j,ns); G1(1,4,ns)= grc(i,n,ns)
              G1(2,1,ns)=  -gr(i,m,ns ); G1(2,2,ns)= grc(m,m,ns); G1(2,3,ns)= grc(m,j,ns); G1(2,4,ns)= grc(m,n,ns)
              G1(3,1,ns)=  -gr(i,j,ns ); G1(3,2,ns)= -gr(m,j,ns); G1(3,3,ns)= grc(j,j,ns); G1(3,4,ns)= grc(j,n,ns)
              G1(4,1,ns)=  -gr(i,n,ns ); G1(4,2,ns)= -gr(m,n,ns); G1(4,3,ns)= -gr(j,n,ns); G1(4,4,ns)= grc(n,n,ns)
           enddo
           Z_res =      (-(G1(1,2,2)*G1(2,1,1)) - G1(1,2,1)*G1(2,1,2) -   &
                &    G1(1,2,2)*G1(2,3,1)*G1(3,1,1) - G1(1,2,1)*G1(2,3,2)*G1(3,1,2) -  &
                &    G1(1,3,1)*G1(2,1,2)*G1(3,2,1) - G1(1,3,2)*G1(2,1,1)*G1(3,2,2) +  &
                &    G1(1,2,2)*G1(2,1,1)*G1(3,3,1) + G1(1,2,1)*G1(2,1,2)*G1(3,3,1) +  &
                &    G1(1,2,2)*G1(2,1,1)*G1(3,3,2) + G1(1,2,1)*G1(2,1,2)*G1(3,3,2) -  &
                &    G1(1,2,2)*G1(2,4,1)*G1(4,1,1) +      2*G1(1,4,2)*G1(2,3,1)*G1(3,2,2)*G1(4,1,1) +  &
                &    2*G1(1,2,2)*G1(2,4,1)*G1(3,3,1)*G1(4,1,1) -      2*G1(1,2,2)*G1(2,3,1)*G1(3,4,1)*G1(4,1,1) -  &
                &    ((G1(1,4,1)*(1 - 4*G1(2,3,1)*G1(3,2,1) - 2*G1(3,3,1) +  &
                &            G1(2,2,1)*(-2 + 4*G1(3,3,1))) +  &
                &         2*G1(1,3,1)*(2*G1(2,4,1)*G1(3,2,1) +  &
                &            (1 - 2*G1(2,2,1))*G1(3,4,1)) +  &
                &         2*G1(1,2,1)*(G1(2,4,1)*(1 - 2*G1(3,3,1)) +  &
                &            2*G1(2,3,1)*G1(3,4,1)))*G1(4,1,1))/2. -  &
                &    G1(1,3,1)*G1(3,4,2)*G1(4,1,1) +  &
                &    2*G1(1,3,1)*G1(2,2,1)*G1(3,4,2)*G1(4,1,1) -  &
                &    2*G1(1,2,1)*G1(2,3,1)*G1(3,4,2)*G1(4,1,1) -  &
                &    2*G1(1,2,2)*G1(2,3,1)*G1(3,4,2)*G1(4,1,1) -  &
                &    G1(1,2,1)*G1(2,4,2)*G1(4,1,2) + &
                &    2*G1(1,4,1)*G1(2,3,2)*G1(3,2,1)*G1(4,1,2) +  &
                &    2*G1(1,2,1)*G1(2,4,2)*G1(3,3,2)*G1(4,1,2) -  &
                &    G1(1,3,2)*G1(3,4,1)*G1(4,1,2) +  &
                &    2*G1(1,3,2)*G1(2,2,2)*G1(3,4,1)*G1(4,1,2) -  &
                &    2*G1(1,2,1)*G1(2,3,2)*G1(3,4,1)*G1(4,1,2) -  &
                &    2*G1(1,2,2)*G1(2,3,2)*G1(3,4,1)*G1(4,1,2) -  &
                &    2*G1(1,2,1)*G1(2,3,2)*G1(3,4,2)*G1(4,1,2) -  &
                &    ((G1(1,4,2)*(1 - 4*G1(2,3,2)*G1(3,2,2) - 2*G1(3,3,2) +  &
                &            G1(2,2,2)*(-2 + 4*G1(3,3,2))) +  &
                &         2*G1(1,3,2)*(2*G1(2,4,2)*G1(3,2,2) +  &
                &            (1 - 2*G1(2,2,2))*G1(3,4,2)) +  &
                &         2*G1(1,2,2)*(G1(2,4,2)*(1 - 2*G1(3,3,2)) +  &
                &            2*G1(2,3,2)*G1(3,4,2)))*G1(4,1,2))/2. -  &
                &    G1(1,4,1)*G1(2,1,2)*G1(4,2,1) +  &
                &    2*G1(1,3,1)*G1(2,4,2)*G1(3,1,2)*G1(4,2,1) +  &
                &    2*G1(1,4,1)*G1(2,1,2)*G1(3,3,1)*G1(4,2,1) -    2*G1(1,3,1)*G1(2,1,2)*G1(3,4,1)*G1(4,2,1) +  &
                &    ((G1(2,4,1)*(-1 + 4*G1(1,3,1)*G1(3,1,1) +             G1(1,1,1)*(2 - 4*G1(3,3,1)) + 2*G1(3,3,1)) +  &
                &         G1(1,4,1)*(-4*G1(2,3,1)*G1(3,1,1) +             G1(2,1,1)*(-2 + 4*G1(3,3,1))) -  &
                &         2*(2*G1(1,3,1)*G1(2,1,1) + (1 - 2*G1(1,1,1))*G1(2,3,1))* &
                &          G1(3,4,1))*G1(4,2,1))/2. -     2*G1(1,3,1)*G1(2,1,1)*G1(3,4,2)*G1(4,2,1) - &
                &    2*G1(1,3,1)*G1(2,1,2)*G1(3,4,2)*G1(4,2,1) -     G1(2,3,1)*G1(3,4,2)*G1(4,2,1) +  &
                &    2*G1(1,1,1)*G1(2,3,1)*G1(3,4,2)*G1(4,2,1) -     G1(1,4,2)*G1(2,1,1)*G1(4,2,2) +  &
                &    2*G1(1,3,2)*G1(2,4,1)*G1(3,1,1)*G1(4,2,2) +      2*G1(1,4,2)*G1(2,1,1)*G1(3,3,2)*G1(4,2,2) -  &
                &    2*G1(1,3,2)*G1(2,1,1)*G1(3,4,1)*G1(4,2,2) -      2*G1(1,3,2)*G1(2,1,2)*G1(3,4,1)*G1(4,2,2) - &
                &    G1(2,3,2)*G1(3,4,1)*G1(4,2,2) +     2*G1(1,1,2)*G1(2,3,2)*G1(3,4,1)*G1(4,2,2) - &
                &    2*G1(1,3,2)*G1(2,1,1)*G1(3,4,2)*G1(4,2,2) +     ((G1(2,4,2)*(-1 + 4*G1(1,3,2)*G1(3,1,2) +  &
                &            G1(1,1,2)*(2 - 4*G1(3,3,2)) + 2*G1(3,3,2)) +           G1(1,4,2)*(-4*G1(2,3,2)*G1(3,1,2) + &
                &            G1(2,1,2)*(-2 + 4*G1(3,3,2))) -           2*(2*G1(1,3,2)*G1(2,1,2) + (1 - 2*G1(1,1,2))*G1(2,3,2))*&
                &          G1(3,4,2))*G1(4,2,2))/2. -     2*G1(1,2,2)*G1(2,4,1)*G1(3,1,1)*G1(4,3,1) - &
                &    G1(1,4,2)*G1(3,1,2)*G1(4,3,1) +     2*G1(1,4,2)*G1(2,2,2)*G1(3,1,2)*G1(4,3,1) - &
                &    2*G1(1,2,1)*G1(2,4,2)*G1(3,1,2)*G1(4,3,1) -     2*G1(1,2,2)*G1(2,4,2)*G1(3,1,2)*G1(4,3,1) - &
                &    2*G1(1,4,1)*G1(2,1,2)*G1(3,2,1)*G1(4,3,1) -     2*G1(1,4,2)*G1(2,1,1)*G1(3,2,2)*G1(4,3,1) - &
                &    2*G1(1,4,2)*G1(2,1,2)*G1(3,2,2)*G1(4,3,1) -     G1(2,4,2)*G1(3,2,2)*G1(4,3,1) + &
                &    2*G1(1,1,2)*G1(2,4,2)*G1(3,2,2)*G1(4,3,1) +     2*G1(1,2,2)*G1(2,1,1)*G1(3,4,1)*G1(4,3,1) + &
                &    2*G1(1,2,1)*G1(2,1,2)*G1(3,4,1)*G1(4,3,1) +     ((-1 + 4*G1(1,2,2)*G1(2,1,2) + G1(1,1,2)*(2 - 4*G1(2,2,2)) + &
                &         2*G1(2,2,2))*G1(3,4,1)*G1(4,3,1))/2. +     ((G1(1,4,1)*((-2 + 4*G1(2,2,1))*G1(3,1,1) - 4*G1(2,1,1)*G1(3,2,1)) + &
                &         G1(1,2,1)*(-4*G1(2,4,1)*G1(3,1,1) + 4*G1(2,1,1)*G1(3,4,1)) +          (-1 + 2*G1(1,1,1))*(2*G1(2,4,1)*G1(3,2,1) + &
                &            (1 - 2*G1(2,2,1))*G1(3,4,1)))*G1(4,3,1))/2. -     G1(3,4,2)*G1(4,3,1) + G1(1,1,1)*G1(3,4,2)*G1(4,3,1) + &
                &    G1(1,1,2)*G1(3,4,2)*G1(4,3,1) +     2*G1(1,2,1)*G1(2,1,1)*G1(3,4,2)*G1(4,3,1) + &
                &    2*G1(1,2,2)*G1(2,1,1)*G1(3,4,2)*G1(4,3,1) +     2*G1(1,2,1)*G1(2,1,2)*G1(3,4,2)*G1(4,3,1) + &
                &    2*G1(1,2,2)*G1(2,1,2)*G1(3,4,2)*G1(4,3,1) +     G1(2,2,1)*G1(3,4,2)*G1(4,3,1) - &
                &    2*G1(1,1,1)*G1(2,2,1)*G1(3,4,2)*G1(4,3,1) +     G1(2,2,2)*G1(3,4,2)*G1(4,3,1) - &
                &    2*G1(1,1,2)*G1(2,2,2)*G1(3,4,2)*G1(4,3,1) -     G1(1,4,1)*G1(3,1,1)*G1(4,3,2) + &
                &    2*G1(1,4,1)*G1(2,2,1)*G1(3,1,1)*G1(4,3,2) -     2*G1(1,2,1)*G1(2,4,1)*G1(3,1,1)*G1(4,3,2) - &
                &    2*G1(1,2,2)*G1(2,4,1)*G1(3,1,1)*G1(4,3,2) -     2*G1(1,2,1)*G1(2,4,2)*G1(3,1,2)*G1(4,3,2) - &
                &    2*G1(1,4,1)*G1(2,1,1)*G1(3,2,1)*G1(4,3,2) -     2*G1(1,4,1)*G1(2,1,2)*G1(3,2,1)*G1(4,3,2) - &
                &    G1(2,4,1)*G1(3,2,1)*G1(4,3,2) +     2*G1(1,1,1)*G1(2,4,1)*G1(3,2,1)*G1(4,3,2) - &
                &    2*G1(1,4,2)*G1(2,1,1)*G1(3,2,2)*G1(4,3,2) - G1(3,4,1)*G1(4,3,2) +   &
                &  G1(1,1,1)*G1(3,4,1)*G1(4,3,2) + G1(1,1,2)*G1(3,4,1)*G1(4,3,2) +     2*G1(1,2,1)*G1(2,1,1)*G1(3,4,1)*G1(4,3,2) + &
                &    2*G1(1,2,2)*G1(2,1,1)*G1(3,4,1)*G1(4,3,2) +     2*G1(1,2,1)*G1(2,1,2)*G1(3,4,1)*G1(4,3,2) + &
                &    2*G1(1,2,2)*G1(2,1,2)*G1(3,4,1)*G1(4,3,2) +     G1(2,2,1)*G1(3,4,1)*G1(4,3,2) - &
                &    2*G1(1,1,1)*G1(2,2,1)*G1(3,4,1)*G1(4,3,2) +     G1(2,2,2)*G1(3,4,1)*G1(4,3,2) - &
                &    2*G1(1,1,2)*G1(2,2,2)*G1(3,4,1)*G1(4,3,2) +     2*G1(1,2,2)*G1(2,1,1)*G1(3,4,2)*G1(4,3,2) + &
                &    2*G1(1,2,1)*G1(2,1,2)*G1(3,4,2)*G1(4,3,2) +     ((-1 + 4*G1(1,2,1)*G1(2,1,1) + G1(1,1,1)*(2 - 4*G1(2,2,1)) + &
                &         2*G1(2,2,1))*G1(3,4,2)*G1(4,3,2))/2. +     ((G1(1,4,2)*((-2 + 4*G1(2,2,2))*G1(3,1,2) - 4*G1(2,1,2)*G1(3,2,2)) + &
                &         G1(1,2,2)*(-4*G1(2,4,2)*G1(3,1,2) + 4*G1(2,1,2)*G1(3,4,2)) +          (-1 + 2*G1(1,1,2))*(2*G1(2,4,2)*G1(3,2,2) + &
                &            (1 - 2*G1(2,2,2))*G1(3,4,2)))*G1(4,3,2))/2. +     2*((G1(1,3,1)*(0.5 - G1(2,2,1)) + G1(1,2,1)*G1(2,3,1))*G1(3,1,1) + &
                &       ((2*G1(1,3,1)*G1(2,1,1) + (1 - 2*G1(1,1,1))*G1(2,3,1))*G1(3,2,1))/        2. + ((1 - 4*G1(1,2,1)*G1(2,1,1) - 2*G1(2,2,1) + &
                &            G1(1,1,1)*(-2 + 4*G1(2,2,1)))*(-1 + 2*G1(3,3,1)))/8.)*     (-0.5 + G1(4,4,1)) + G1(1,2,2)*G1(2,1,1)*G1(4,4,1) + &
                &    G1(1,2,1)*G1(2,1,2)*G1(4,4,1) +     2*G1(1,2,2)*G1(2,3,1)*G1(3,1,1)*G1(4,4,1) + &
                &    2*G1(1,3,1)*G1(2,1,2)*G1(3,2,1)*G1(4,4,1) -     2*G1(1,2,2)*G1(2,1,1)*G1(3,3,1)*G1(4,4,1) - &
                &    2*G1(1,2,1)*G1(2,1,2)*G1(3,3,1)*G1(4,4,1) +     ((1 - 4*G1(1,2,2)*G1(2,1,2) - 2*G1(2,2,2) + &
                &         G1(1,1,2)*(-2 + 4*G1(2,2,2)))*(-1 + 2*G1(3,3,1))*       (-1 + 2*G1(4,4,1)))/8. + &
                &    2*((G1(1,3,2)*(0.5 - G1(2,2,2)) + G1(1,2,2)*G1(2,3,2))*G1(3,1,2) + &
                &       ((2*G1(1,3,2)*G1(2,1,2) + (1 - 2*G1(1,1,2))*G1(2,3,2))*G1(3,2,2))/        2. + ((1 - 4*G1(1,2,2)*G1(2,1,2) - 2*G1(2,2,2) + &
                &            G1(1,1,2)*(-2 + 4*G1(2,2,2)))*(-1 + 2*G1(3,3,2)))/8.)*     (-0.5 + G1(4,4,2)) + G1(1,2,2)*G1(2,1,1)*G1(4,4,2) + &
                &    G1(1,2,1)*G1(2,1,2)*G1(4,4,2) +     2*G1(1,2,1)*G1(2,3,2)*G1(3,1,2)*G1(4,4,2) + &
                &    2*G1(1,3,2)*G1(2,1,1)*G1(3,2,2)*G1(4,4,2) -     2*G1(1,2,2)*G1(2,1,1)*G1(3,3,2)*G1(4,4,2) - &
                &    2*G1(1,2,1)*G1(2,1,2)*G1(3,3,2)*G1(4,4,2) +     ((1 - 4*G1(1,2,1)*G1(2,1,1) - 2*G1(2,2,1) + &
                &         G1(1,1,1)*(-2 + 4*G1(2,2,1)))*(-1 + 2*G1(3,3,2))*       (-1 + 2*G1(4,4,2)))/8.)/2.

        endif
        Predefined_Obs_dimer_eq = Z_res
           
      end function Predefined_Obs_dimer_eq


!-------------------------------------------------------------------
!> @author
!> ALF-project
!
!>  @brief
!>  Let   S^{alpha}_{beta}(i)   =   c^{\dagger}_{\alpha}  c_{\beta}   - \delta{\alpha,\beta}/2 
!>  The routine returns 
!>       << S^{alpha}_{beta}(i,\tau)  S^{beta}_{alpha}(m,/tau)  S^{delta}_{gamma}(j)  S^{gamma}_{delta}(n)>>
!>  If N_FL = 1 then N_SUN can take any value.
!>  If N_FL = 2 then N_SUN = 1 
!--------------------------------------------------------------------
      Complex (Kind=Kind(0.d0)) function Predefined_Obs_dimer_tau(I,M,J,N, GT0,G0T,G00,GTT, N_SUN, N_FL) 
          
        USE runtime_error_mod 
        Implicit none
        
        Integer, Intent(IN) ::  I,M,J, N, N_SUN, N_FL
        Complex (Kind=Kind(0.d0)), Dimension(:,:,:), INTENT(IN) :: GT0,G0T,G00,GTT
        
        
        ! local
        Complex (Kind=Kind(0.d0)) ::  G(4,4),  Z_res, G1(4,4,2), Zmi, Zjn
        Integer ::  ns
        
        
        !Wick decomp is carried out with Mathematica. See  notebooks:  $ALF/Mathematica/Dimer-Dimer_SU2_NFL_2.nb
        ! and $ALF/Mathematica/Dimer-Dimer_SUN_NFL_1.nb 
        Z_res = cmplx(0.d0,0.d0,Kind(0.d0))

        Zmi = 0.d0
        if (m == i )  Zmi = 1.d0
        Zjn = 0.d0
        if (j == n )  Zjn = 1.d0
        If (N_FL == 1) then
!!$           G(1,1)=   grc(i,i,1); G(1,2)= grc(i,m,1); G(1,3)= grc(i,j,1); G(1,4)= grc(i,n,1)
!!$           G(2,1)=  -gr(i,m,1) ; G(2,2)= grc(m,m,1); G(2,3)= grc(m,j,1); G(2,4)= grc(m,n,1)
!!$           G(3,1)=  -gr(i,j,1) ; G(3,2)= -gr(m,j,1); G(3,3)= grc(j,j,1); G(3,4)= grc(j,n,1)
!!$           G(4,1)=  -gr(i,n,1) ; G(4,2)= -gr(m,n,1); G(4,3)= -gr(j,n,1); G(4,4)= grc(n,n,1)
           G(1,1)= 1.d0 - GTT(I,I,1)  ;   G(1,2)= Zmi  - GTT(M,I,1)  ;  G(1,3)= - G0T(J,I,1)     ;  G(1,4)= -G0T(N,I,1)
           G(2,1)= -GTT(I,M,1)        ;   G(2,2)= 1.d0 - GTT(M,M,1)  ;  G(2,3)= - G0T(j,m,1)     ;  G(2,4)= -G0T(N,M,1)
           G(3,1)= -GT0(I,J,1)        ;   G(3,2)= -GT0(M,J,1)        ;  G(3,3)= 1.d0 - G00(J,J,1);  G(3,4)= Zjn-G00(N,J,1)
           G(4,1)= -GT0(I,N,1)        ;   G(4,2)= -GT0(M,N,1)        ;  G(4,3)= -G00(J,N,1)      ;  G(4,4)= 1.d0 - G00(N,N,1)       
           select Case(N_SUN)
           case(2)           
              Z_res =  (1.0 - 2.0*G(1,3)*G(3,1) + G(2,2)*(-2.0 + 4.0*G(1,3)*G(3,1)) - 2.0*G(3,3) -  &
                   &  2.0*G(1,4)*G(4,1) + 4.0*G(2,2)*(G(3,3) + G(1,4)*G(4,1)) +                   &
                   &  2.0*(2.0*G(1,4)*G(3,3)*G(4,1) - 4.0*G(1,4)*G(2,2)*G(3,3)*G(4,1) -           &
                   &  4.0*G(1,4)*G(2,1)*G(4,2) - G(2,4)*G(4,2) +                                  &
                   &  8.0*G(1,4)*G(2,1)*G(3,3)*G(4,2) + 2.0*G(2,4)*G(3,3)*G(4,2) +                &
                   &  G(2,3)*(G(3,2)*(-1.0 + 8.0*G(1,4)*G(4,1)) -                                 &
                   &  4.0*(G(1,4)*G(3,1) + G(3,4))*G(4,2)) -                                      &
                   &  4.0*G(1,3)*((G(2,4)*G(3,2) + G(3,4) - 2.0*G(2,2)*G(3,4))*G(4,1) -           &
                   &  2.0*G(2,4)*G(3,1)*G(4,2) + G(2,1)*(G(3,2) + 4.0*G(3,4)*G(4,2))) -           &
                   &  4.0*(G(2,4)*G(3,2) + G(1,4)*                                                &
                   &  (G(3,1) - 2.0*G(2,2)*G(3,1) + 4.0*G(2,1)*G(3,2)) + G(3,4) -                 &
                   &  2.0*G(2,2)*G(3,4))*G(4,3)) - 2.0*G(4,4) +                                   &
                   &  4.0*(G(2,3)*G(3,2) + G(1,3)*(G(3,1) + 4.0*G(2,1)*G(3,2)) +                  &
                   &  G(2,2)*(1.0 - 2*G(1,3)*G(3,1) - 2.0*G(3,3)) + G(3,3))*G(4,4) -              &
                   &  8.0*G(1,2)*(G(2,4)*(G(4,1) - 2.0*G(3,3)*G(4,1) + 4.0*G(3,1)*G(4,3)) +       &
                   &  G(2,3)*(G(3,1) + 4.0*G(3,4)*G(4,1) - 2.0*G(3,1)*G(4,4)) +                     &
                   &  G(2,1)*(1.0 - 8.0*G(3,4)*G(4,3) - 2.0*G(4,4) + G(3,3)*(-2.0+4.0*G(4,4))))  +  &
                   &  2.0*G(1,1)*(-((-1.0 + 2.0*G(3,3))*(-1.0 + 2.0*G(2,4)*G(4,2))) + 2.0*G(4,4)  + &
                   &  2.0*G(2,2)*(1.0 - 8.0*G(3,4)*G(4,3) - 2.0*G(4,4) + G(3,3)*(-2.0+4.0*G(4,4)))+ &
                   &  2.0*(4.0*(G(2,4)*G(3,2) + G(3,4))*G(4,3) - 2.0*G(3,3)*G(4,4) +                &
                   &  G(2,3)*(G(3,2) + 4.0*G(3,4)*G(4,2) - 2.0*G(3,2)*G(4,4)))))/4.0
           case(4)
              Z_res  =    +  1.0 - 2.*G(2,2) - G(1,3)*G(3,1) + 2.*G(1,3)*G(2,2)*G(3,1) -  &
                   &   8.*G(1,3)*G(2,1)*G(3,2) - G(2,3)*G(3,2) - 2.*G(3,3) + 4.*G(2,2)*G(3,3) - &
                   &   G(1,4)*G(4,1) + 2.*G(1,4)*G(2,2)*G(4,1) + 16.*G(1,4)*G(2,3)*G(3,2)*G(4,1) -   &
                   &   4.*G(1,3)*G(2,4)*G(3,2)*G(4,1) + 2.*G(1,4)*G(3,3)*G(4,1) -  &
                   &   4.*G(1,4)*G(2,2)*G(3,3)*G(4,1) - 8.*G(1,3)*G(3,4)*G(4,1) +  &
                   &   16.*G(1,3)*G(2,2)*G(3,4)*G(4,1) - 8.*G(1,4)*G(2,1)*G(4,2) - G(2,4)*G(4,2) -  &
                   &   4.*G(1,4)*G(2,3)*G(3,1)*G(4,2) + 16.*G(1,3)*G(2,4)*G(3,1)*G(4,2) + &
                   &   16.*G(1,4)*G(2,1)*G(3,3)*G(4,2) + 2.*G(2,4)*G(3,3)*G(4,2) -   &
                   &   64.*G(1,3)*G(2,1)*G(3,4)*G(4,2) - 8.*G(2,3)*G(3,4)*G(4,2) -  &
                   &   8.*G(1,4)*G(3,1)*G(4,3) + 16.*G(1,4)*G(2,2)*G(3,1)*G(4,3) -  &
                   &   64.*G(1,4)*G(2,1)*G(3,2)*G(4,3) - 8.*G(2,4)*G(3,2)*G(4,3) -   &
                   &   16.*G(3,4)*G(4,3) + 32.*G(2,2)*G(3,4)*G(4,3) +  &
                   &   2.*(-1. + G(2,3)*G(3,2) + G(1,3)*(G(3,1) + 8.*G(2,1)*G(3,2)) + 2.*G(3,3) -  &
                   &   2.*G(2,2)*(-1. + G(1,3)*G(3,1) + 2.*G(3,3)))*G(4,4) -   &
                   &   8.*G(1,2)*(G(2,4)*(G(4,1) - 2.*G(3,3)*G(4,1) + 8.*G(3,1)*G(4,3)) +  &
                   &   G(2,3)*(G(3,1) + 8.*G(3,4)*G(4,1) - 2.*G(3,1)*G(4,4)) +  &
                   &   G(2,1)*(2. - 32.*G(3,4)*G(4,3) - 4.*G(4,4) + G(3,3)*(-4. + 8.*G(4,4)))) +  &
                   &   2.*G(1,1)*(-((-1. + 2.*G(3,3))*(-1. + G(2,4)*G(4,2))) +   &
                   &   8.*(G(2,4)*G(3,2) + 2.*G(3,4))*G(4,3) +   G(2,3)*(8.*G(3,4)*G(4,2) + &
                   &   G(3,2)*(1. - 2.*G(4,4))) + 2.*G(4,4) - 4.*G(3,3)*G(4,4) + G(2,2)* &
                   &   (2. - 32.*G(3,4)*G(4,3) - 4.*G(4,4) +   G(3,3)*(-4. + 8.*G(4,4))))
           case (6)
              Z_res  =   (3*(3 - 2*G(1,3)*G(3,1) + G(2,2)*(-6 + 4*G(1,3)*G(3,1)) -  &
                   &      2*(12*G(1,3)*G(2,1) + G(2,3))*G(3,2) - 6*G(3,3) - 2*G(1,4)*G(4,1) + &
                   &      4*(G(1,4)*(12*G(2,3)*G(3,2) + (1 - 2*G(2,2))*G(3,3)) - &
                   &      2*G(1,3)*(G(2,4)*G(3,2) + 3*(1 - 2*G(2,2))*G(3,4)))*G(4,1) + &
                   &      4*G(2,2)*(3*G(3,3) + G(1,4)*G(4,1)) + &
                   &      2*(-4*G(1,4)*(G(2,3)*G(3,1) + G(2,1)*(3 - 6*G(3,3))) + &
                   &      G(2,4)*(-1 + 24*G(1,3)*G(3,1) + 2*G(3,3)) - &
                   &      12*(12*G(1,3)*G(2,1) + G(2,3))*G(3,4))*G(4,2) - &
                   &      24*(G(2,4)*G(3,2) + G(1,4)* &
                   &      ((1 - 2*G(2,2))*G(3,1) + 12*G(2,1)*G(3,2)) + &
                   &      3*(1 - 2*G(2,2))*G(3,4))*G(4,3) - 6*G(4,4) + &
                   &      4*(G(2,3)*G(3,2) + G(1,3)*(G(3,1) + 12*G(2,1)*G(3,2)) + &
                   &      G(2,2)*(3 - 2*G(1,3)*G(3,1) - 6*G(3,3)) + 3*G(3,3))*G(4,4) - &
                   &      24*G(1,2)*(G(2,4)*(G(4,1) - 2*G(3,3)*G(4,1) + 12*G(3,1)*G(4,3)) + &
                   &      G(2,3)*(G(3,1) + 12*G(3,4)*G(4,1) - 2*G(3,1)*G(4,4)) + &
                   &      3*G(2,1)*(1 - 24*G(3,4)*G(4,3) - 2*G(4,4) + &
                   &      G(3,3)*(-2 + 4*G(4,4)))) +  &
                   &      2*G(1,1)*(-((-1 + 2*G(3,3))*(-3 + 2*G(2,4)*G(4,2))) + &
                   &      24*(G(2,4)*G(3,2) + 3*G(3,4))*G(4,3) + &
                   &      2*G(2,3)*(12*G(3,4)*G(4,2) + G(3,2)*(1 - 2*G(4,4))) + 6*G(4,4) - &
                   &      12*G(3,3)*G(4,4) + 6*G(2,2)*&
                   &      (1 - 24*G(3,4)*G(4,3) - 2*G(4,4) + G(3,3)*(-2 + 4*G(4,4))))))/4.
           case(8)
              Z_res = 2*(2 - 4*G(2,2) - G(1,3)*G(3,1) + 2*G(1,3)*G(2,2)*G(3,1) - &
                   &    16*G(1,3)*G(2,1)*G(3,2) - G(2,3)*G(3,2) - 4*G(3,3) + 8*G(2,2)*G(3,3) - &
                   &    G(1,4)*G(4,1) + 2*G(1,4)*G(2,2)*G(4,1) + &
                   &    32*G(1,4)*G(2,3)*G(3,2)*G(4,1) - 4*G(1,3)*G(2,4)*G(3,2)*G(4,1) + &
                   &    2*G(1,4)*G(3,3)*G(4,1) - 4*G(1,4)*G(2,2)*G(3,3)*G(4,1) - &
                   &    16*G(1,3)*G(3,4)*G(4,1) + 32*G(1,3)*G(2,2)*G(3,4)*G(4,1) - &
                   &    16*G(1,4)*G(2,1)*G(4,2) - G(2,4)*G(4,2) - &
                   &    4*G(1,4)*G(2,3)*G(3,1)*G(4,2) + 32*G(1,3)*G(2,4)*G(3,1)*G(4,2) + &
                   &    32*G(1,4)*G(2,1)*G(3,3)*G(4,2) + 2*G(2,4)*G(3,3)*G(4,2) - &
                   &    256*G(1,3)*G(2,1)*G(3,4)*G(4,2) - 16*G(2,3)*G(3,4)*G(4,2) - &
                   &    16*G(1,4)*G(3,1)*G(4,3) + 32*G(1,4)*G(2,2)*G(3,1)*G(4,3) - &
                   &    256*G(1,4)*G(2,1)*G(3,2)*G(4,3) - 16*G(2,4)*G(3,2)*G(4,3) - &
                   &    64*G(3,4)*G(4,3) + 128*G(2,2)*G(3,4)*G(4,3) + &
                   &    2*(-2 + G(2,3)*G(3,2) + G(1,3)*(G(3,1) + 16*G(2,1)*G(3,2)) + &
                   &    4*G(3,3) - 2*G(2,2)*(-2 + G(1,3)*G(3,1) + 4*G(3,3)))*G(4,4) - &
                   &    16*G(1,2)*(G(2,4)*(G(4,1) - 2*G(3,3)*G(4,1) + 16*G(3,1)*G(4,3)) + &
                   &    G(2,3)*(G(3,1) + 16*G(3,4)*G(4,1) - 2*G(3,1)*G(4,4)) + &
                   &    4*G(2,1)*(1 - 32*G(3,4)*G(4,3) - 2*G(4,4) + G(3,3)*(-2 + 4*G(4,4)))) + &
                   &    2*G(1,1)*(-((-1 + 2*G(3,3))*(-2 + G(2,4)*G(4,2))) +  &
                   &    16*(G(2,4)*G(3,2) + 4*G(3,4))*G(4,3) + &
                   &    G(2,3)*(16*G(3,4)*G(4,2) + G(3,2)*(1 - 2*G(4,4))) + 4*G(4,4) - &
                   &    8*G(3,3)*G(4,4) + 4*G(2,2)*&
                   &    (1 - 32*G(3,4)*G(4,3) - 2*G(4,4) + G(3,3)*(-2 + 4*G(4,4)))))
           case  default
              Write(error_unit,*) 'Dimer, N_SUN=', N_SUN, 'is not yet implemented'
              CALL Terminate_on_error(ERROR_MISSING_OBS,__FILE__,__LINE__)
           end select
        elseif(N_FL == 2 ) then  !  This only works for N_SUN = 1
           do ns = 1,2
              G1(1,1,ns)= 1.d0 - GTT(I,I,ns);G1(1,2,ns)= Zmi  - GTT(M,I,ns);G1(1,3,ns)= - G0T(J,I,ns)     ;G1(1,4,ns)= -G0T(N,I,ns)
              G1(2,1,ns)= -GTT(I,M,ns)      ;G1(2,2,ns)= 1.d0 - GTT(M,M,ns);G1(2,3,ns)= - G0T(j,m,ns)     ;G1(2,4,ns)= -G0T(N,M,ns)
              G1(3,1,ns)= -GT0(I,J,ns)      ;G1(3,2,ns)= -GT0(M,J,ns)      ;G1(3,3,ns)= 1.d0 - G00(J,J,ns);G1(3,4,ns)= Zjn-G00(N,J,ns)
              G1(4,1,ns)= -GT0(I,N,ns)      ;G1(4,2,ns)= -GT0(M,N,ns)      ;G1(4,3,ns)= -G00(J,N,ns)      ;G1(4,4,ns)= 1.d0 - G00(N,N,ns)       
!!$              G1(1,1,ns)=   grc(i,i,ns); G1(1,2,ns)= grc(i,m,ns); G1(1,3,ns)= grc(i,j,ns); G1(1,4,ns)= grc(i,n,ns)
!!$              G1(2,1,ns)=  -gr(i,m,ns ); G1(2,2,ns)= grc(m,m,ns); G1(2,3,ns)= grc(m,j,ns); G1(2,4,ns)= grc(m,n,ns)
!!$              G1(3,1,ns)=  -gr(i,j,ns ); G1(3,2,ns)= -gr(m,j,ns); G1(3,3,ns)= grc(j,j,ns); G1(3,4,ns)= grc(j,n,ns)
!!$              G1(4,1,ns)=  -gr(i,n,ns ); G1(4,2,ns)= -gr(m,n,ns); G1(4,3,ns)= -gr(j,n,ns); G1(4,4,ns)= grc(n,n,ns)
           enddo
           Z_res =      (-(G1(1,2,2)*G1(2,1,1)) - G1(1,2,1)*G1(2,1,2) -   &
                &    G1(1,2,2)*G1(2,3,1)*G1(3,1,1) - G1(1,2,1)*G1(2,3,2)*G1(3,1,2) -  &
                &    G1(1,3,1)*G1(2,1,2)*G1(3,2,1) - G1(1,3,2)*G1(2,1,1)*G1(3,2,2) +  &
                &    G1(1,2,2)*G1(2,1,1)*G1(3,3,1) + G1(1,2,1)*G1(2,1,2)*G1(3,3,1) +  &
                &    G1(1,2,2)*G1(2,1,1)*G1(3,3,2) + G1(1,2,1)*G1(2,1,2)*G1(3,3,2) -  &
                &    G1(1,2,2)*G1(2,4,1)*G1(4,1,1) +      2*G1(1,4,2)*G1(2,3,1)*G1(3,2,2)*G1(4,1,1) +  &
                &    2*G1(1,2,2)*G1(2,4,1)*G1(3,3,1)*G1(4,1,1) -      2*G1(1,2,2)*G1(2,3,1)*G1(3,4,1)*G1(4,1,1) -  &
                &    ((G1(1,4,1)*(1 - 4*G1(2,3,1)*G1(3,2,1) - 2*G1(3,3,1) +  &
                &            G1(2,2,1)*(-2 + 4*G1(3,3,1))) +  &
                &         2*G1(1,3,1)*(2*G1(2,4,1)*G1(3,2,1) +  &
                &            (1 - 2*G1(2,2,1))*G1(3,4,1)) +  &
                &         2*G1(1,2,1)*(G1(2,4,1)*(1 - 2*G1(3,3,1)) +  &
                &            2*G1(2,3,1)*G1(3,4,1)))*G1(4,1,1))/2. -  &
                &    G1(1,3,1)*G1(3,4,2)*G1(4,1,1) +  &
                &    2*G1(1,3,1)*G1(2,2,1)*G1(3,4,2)*G1(4,1,1) -  &
                &    2*G1(1,2,1)*G1(2,3,1)*G1(3,4,2)*G1(4,1,1) -  &
                &    2*G1(1,2,2)*G1(2,3,1)*G1(3,4,2)*G1(4,1,1) -  &
                &    G1(1,2,1)*G1(2,4,2)*G1(4,1,2) + &
                &    2*G1(1,4,1)*G1(2,3,2)*G1(3,2,1)*G1(4,1,2) +  &
                &    2*G1(1,2,1)*G1(2,4,2)*G1(3,3,2)*G1(4,1,2) -  &
                &    G1(1,3,2)*G1(3,4,1)*G1(4,1,2) +  &
                &    2*G1(1,3,2)*G1(2,2,2)*G1(3,4,1)*G1(4,1,2) -  &
                &    2*G1(1,2,1)*G1(2,3,2)*G1(3,4,1)*G1(4,1,2) -  &
                &    2*G1(1,2,2)*G1(2,3,2)*G1(3,4,1)*G1(4,1,2) -  &
                &    2*G1(1,2,1)*G1(2,3,2)*G1(3,4,2)*G1(4,1,2) -  &
                &    ((G1(1,4,2)*(1 - 4*G1(2,3,2)*G1(3,2,2) - 2*G1(3,3,2) +  &
                &            G1(2,2,2)*(-2 + 4*G1(3,3,2))) +  &
                &         2*G1(1,3,2)*(2*G1(2,4,2)*G1(3,2,2) +  &
                &            (1 - 2*G1(2,2,2))*G1(3,4,2)) +  &
                &         2*G1(1,2,2)*(G1(2,4,2)*(1 - 2*G1(3,3,2)) +  &
                &            2*G1(2,3,2)*G1(3,4,2)))*G1(4,1,2))/2. -  &
                &    G1(1,4,1)*G1(2,1,2)*G1(4,2,1) +  &
                &    2*G1(1,3,1)*G1(2,4,2)*G1(3,1,2)*G1(4,2,1) +  &
                &    2*G1(1,4,1)*G1(2,1,2)*G1(3,3,1)*G1(4,2,1) -    2*G1(1,3,1)*G1(2,1,2)*G1(3,4,1)*G1(4,2,1) +  &
                &    ((G1(2,4,1)*(-1 + 4*G1(1,3,1)*G1(3,1,1) +             G1(1,1,1)*(2 - 4*G1(3,3,1)) + 2*G1(3,3,1)) +  &
                &         G1(1,4,1)*(-4*G1(2,3,1)*G1(3,1,1) +             G1(2,1,1)*(-2 + 4*G1(3,3,1))) -  &
                &         2*(2*G1(1,3,1)*G1(2,1,1) + (1 - 2*G1(1,1,1))*G1(2,3,1))* &
                &          G1(3,4,1))*G1(4,2,1))/2. -     2*G1(1,3,1)*G1(2,1,1)*G1(3,4,2)*G1(4,2,1) - &
                &    2*G1(1,3,1)*G1(2,1,2)*G1(3,4,2)*G1(4,2,1) -     G1(2,3,1)*G1(3,4,2)*G1(4,2,1) +  &
                &    2*G1(1,1,1)*G1(2,3,1)*G1(3,4,2)*G1(4,2,1) -     G1(1,4,2)*G1(2,1,1)*G1(4,2,2) +  &
                &    2*G1(1,3,2)*G1(2,4,1)*G1(3,1,1)*G1(4,2,2) +      2*G1(1,4,2)*G1(2,1,1)*G1(3,3,2)*G1(4,2,2) -  &
                &    2*G1(1,3,2)*G1(2,1,1)*G1(3,4,1)*G1(4,2,2) -      2*G1(1,3,2)*G1(2,1,2)*G1(3,4,1)*G1(4,2,2) - &
                &    G1(2,3,2)*G1(3,4,1)*G1(4,2,2) +     2*G1(1,1,2)*G1(2,3,2)*G1(3,4,1)*G1(4,2,2) - &
                &    2*G1(1,3,2)*G1(2,1,1)*G1(3,4,2)*G1(4,2,2) +     ((G1(2,4,2)*(-1 + 4*G1(1,3,2)*G1(3,1,2) +  &
                &            G1(1,1,2)*(2 - 4*G1(3,3,2)) + 2*G1(3,3,2)) +           G1(1,4,2)*(-4*G1(2,3,2)*G1(3,1,2) + &
                &            G1(2,1,2)*(-2 + 4*G1(3,3,2))) -           2*(2*G1(1,3,2)*G1(2,1,2) + (1 - 2*G1(1,1,2))*G1(2,3,2))*&
                &          G1(3,4,2))*G1(4,2,2))/2. -     2*G1(1,2,2)*G1(2,4,1)*G1(3,1,1)*G1(4,3,1) - &
                &    G1(1,4,2)*G1(3,1,2)*G1(4,3,1) +     2*G1(1,4,2)*G1(2,2,2)*G1(3,1,2)*G1(4,3,1) - &
                &    2*G1(1,2,1)*G1(2,4,2)*G1(3,1,2)*G1(4,3,1) -     2*G1(1,2,2)*G1(2,4,2)*G1(3,1,2)*G1(4,3,1) - &
                &    2*G1(1,4,1)*G1(2,1,2)*G1(3,2,1)*G1(4,3,1) -     2*G1(1,4,2)*G1(2,1,1)*G1(3,2,2)*G1(4,3,1) - &
                &    2*G1(1,4,2)*G1(2,1,2)*G1(3,2,2)*G1(4,3,1) -     G1(2,4,2)*G1(3,2,2)*G1(4,3,1) + &
                &    2*G1(1,1,2)*G1(2,4,2)*G1(3,2,2)*G1(4,3,1) +     2*G1(1,2,2)*G1(2,1,1)*G1(3,4,1)*G1(4,3,1) + &
                &    2*G1(1,2,1)*G1(2,1,2)*G1(3,4,1)*G1(4,3,1) +     ((-1 + 4*G1(1,2,2)*G1(2,1,2) + G1(1,1,2)*(2 - 4*G1(2,2,2)) + &
                &         2*G1(2,2,2))*G1(3,4,1)*G1(4,3,1))/2. +     ((G1(1,4,1)*((-2 + 4*G1(2,2,1))*G1(3,1,1) - 4*G1(2,1,1)*G1(3,2,1)) + &
                &         G1(1,2,1)*(-4*G1(2,4,1)*G1(3,1,1) + 4*G1(2,1,1)*G1(3,4,1)) +          (-1 + 2*G1(1,1,1))*(2*G1(2,4,1)*G1(3,2,1) + &
                &            (1 - 2*G1(2,2,1))*G1(3,4,1)))*G1(4,3,1))/2. -     G1(3,4,2)*G1(4,3,1) + G1(1,1,1)*G1(3,4,2)*G1(4,3,1) + &
                &    G1(1,1,2)*G1(3,4,2)*G1(4,3,1) +     2*G1(1,2,1)*G1(2,1,1)*G1(3,4,2)*G1(4,3,1) + &
                &    2*G1(1,2,2)*G1(2,1,1)*G1(3,4,2)*G1(4,3,1) +     2*G1(1,2,1)*G1(2,1,2)*G1(3,4,2)*G1(4,3,1) + &
                &    2*G1(1,2,2)*G1(2,1,2)*G1(3,4,2)*G1(4,3,1) +     G1(2,2,1)*G1(3,4,2)*G1(4,3,1) - &
                &    2*G1(1,1,1)*G1(2,2,1)*G1(3,4,2)*G1(4,3,1) +     G1(2,2,2)*G1(3,4,2)*G1(4,3,1) - &
                &    2*G1(1,1,2)*G1(2,2,2)*G1(3,4,2)*G1(4,3,1) -     G1(1,4,1)*G1(3,1,1)*G1(4,3,2) + &
                &    2*G1(1,4,1)*G1(2,2,1)*G1(3,1,1)*G1(4,3,2) -     2*G1(1,2,1)*G1(2,4,1)*G1(3,1,1)*G1(4,3,2) - &
                &    2*G1(1,2,2)*G1(2,4,1)*G1(3,1,1)*G1(4,3,2) -     2*G1(1,2,1)*G1(2,4,2)*G1(3,1,2)*G1(4,3,2) - &
                &    2*G1(1,4,1)*G1(2,1,1)*G1(3,2,1)*G1(4,3,2) -     2*G1(1,4,1)*G1(2,1,2)*G1(3,2,1)*G1(4,3,2) - &
                &    G1(2,4,1)*G1(3,2,1)*G1(4,3,2) +     2*G1(1,1,1)*G1(2,4,1)*G1(3,2,1)*G1(4,3,2) - &
                &    2*G1(1,4,2)*G1(2,1,1)*G1(3,2,2)*G1(4,3,2) - G1(3,4,1)*G1(4,3,2) +   &
                &  G1(1,1,1)*G1(3,4,1)*G1(4,3,2) + G1(1,1,2)*G1(3,4,1)*G1(4,3,2) +     2*G1(1,2,1)*G1(2,1,1)*G1(3,4,1)*G1(4,3,2) + &
                &    2*G1(1,2,2)*G1(2,1,1)*G1(3,4,1)*G1(4,3,2) +     2*G1(1,2,1)*G1(2,1,2)*G1(3,4,1)*G1(4,3,2) + &
                &    2*G1(1,2,2)*G1(2,1,2)*G1(3,4,1)*G1(4,3,2) +     G1(2,2,1)*G1(3,4,1)*G1(4,3,2) - &
                &    2*G1(1,1,1)*G1(2,2,1)*G1(3,4,1)*G1(4,3,2) +     G1(2,2,2)*G1(3,4,1)*G1(4,3,2) - &
                &    2*G1(1,1,2)*G1(2,2,2)*G1(3,4,1)*G1(4,3,2) +     2*G1(1,2,2)*G1(2,1,1)*G1(3,4,2)*G1(4,3,2) + &
                &    2*G1(1,2,1)*G1(2,1,2)*G1(3,4,2)*G1(4,3,2) +     ((-1 + 4*G1(1,2,1)*G1(2,1,1) + G1(1,1,1)*(2 - 4*G1(2,2,1)) + &
                &         2*G1(2,2,1))*G1(3,4,2)*G1(4,3,2))/2. +     ((G1(1,4,2)*((-2 + 4*G1(2,2,2))*G1(3,1,2) - 4*G1(2,1,2)*G1(3,2,2)) + &
                &         G1(1,2,2)*(-4*G1(2,4,2)*G1(3,1,2) + 4*G1(2,1,2)*G1(3,4,2)) +          (-1 + 2*G1(1,1,2))*(2*G1(2,4,2)*G1(3,2,2) + &
                &            (1 - 2*G1(2,2,2))*G1(3,4,2)))*G1(4,3,2))/2. +     2*((G1(1,3,1)*(0.5 - G1(2,2,1)) + G1(1,2,1)*G1(2,3,1))*G1(3,1,1) + &
                &       ((2*G1(1,3,1)*G1(2,1,1) + (1 - 2*G1(1,1,1))*G1(2,3,1))*G1(3,2,1))/        2. + ((1 - 4*G1(1,2,1)*G1(2,1,1) - 2*G1(2,2,1) + &
                &            G1(1,1,1)*(-2 + 4*G1(2,2,1)))*(-1 + 2*G1(3,3,1)))/8.)*     (-0.5 + G1(4,4,1)) + G1(1,2,2)*G1(2,1,1)*G1(4,4,1) + &
                &    G1(1,2,1)*G1(2,1,2)*G1(4,4,1) +     2*G1(1,2,2)*G1(2,3,1)*G1(3,1,1)*G1(4,4,1) + &
                &    2*G1(1,3,1)*G1(2,1,2)*G1(3,2,1)*G1(4,4,1) -     2*G1(1,2,2)*G1(2,1,1)*G1(3,3,1)*G1(4,4,1) - &
                &    2*G1(1,2,1)*G1(2,1,2)*G1(3,3,1)*G1(4,4,1) +     ((1 - 4*G1(1,2,2)*G1(2,1,2) - 2*G1(2,2,2) + &
                &         G1(1,1,2)*(-2 + 4*G1(2,2,2)))*(-1 + 2*G1(3,3,1))*       (-1 + 2*G1(4,4,1)))/8. + &
                &    2*((G1(1,3,2)*(0.5 - G1(2,2,2)) + G1(1,2,2)*G1(2,3,2))*G1(3,1,2) + &
                &       ((2*G1(1,3,2)*G1(2,1,2) + (1 - 2*G1(1,1,2))*G1(2,3,2))*G1(3,2,2))/        2. + ((1 - 4*G1(1,2,2)*G1(2,1,2) - 2*G1(2,2,2) + &
                &            G1(1,1,2)*(-2 + 4*G1(2,2,2)))*(-1 + 2*G1(3,3,2)))/8.)*     (-0.5 + G1(4,4,2)) + G1(1,2,2)*G1(2,1,1)*G1(4,4,2) + &
                &    G1(1,2,1)*G1(2,1,2)*G1(4,4,2) +     2*G1(1,2,1)*G1(2,3,2)*G1(3,1,2)*G1(4,4,2) + &
                &    2*G1(1,3,2)*G1(2,1,1)*G1(3,2,2)*G1(4,4,2) -     2*G1(1,2,2)*G1(2,1,1)*G1(3,3,2)*G1(4,4,2) - &
                &    2*G1(1,2,1)*G1(2,1,2)*G1(3,3,2)*G1(4,4,2) +     ((1 - 4*G1(1,2,1)*G1(2,1,1) - 2*G1(2,2,1) + &
                &         G1(1,1,1)*(-2 + 4*G1(2,2,1)))*(-1 + 2*G1(3,3,2))*       (-1 + 2*G1(4,4,2)))/8.)/2.

        endif
        Predefined_Obs_dimer_tau = Z_res
           
      end function Predefined_Obs_dimer_tau


!-------------------------------------------------------------------
!> @author
!> ALF-project
!
!>  @brief
!>  Let  \tilde{f}^{\dagger}_{i,\sigma}  be the cotunneling  composite fermion operator  (see notes).  This routine computes
!>  \sum_{sigma} < \tilde{f}^{\dagger}_{i,\sigma}(tau)  \tilde{f}_{j,\sigma}(0)>
!>
!>  If N_FL = 1 then N_SUN can take any value.
!>  If N_FL = 2 then N_SUN = 1 
!--------------------------------------------------------------------
      Complex (Kind=Kind(0.d0)) function Predefined_Obs_Cotunneling(I_c, I_f, J_c, J_f,  GT0,G0T,G00,GTT, N_SUN, N_FL) 

        USE runtime_error_mod 
        !Why is there no implicit none here?
        Integer,              Intent(In)      :: N_SUN, I_c,I_f, J_c, J_f, N_FL
        Complex (Kind=Kind(0.d0)), Intent(In) :: GT0(:,:,:), G0T(:,:,:), G00(:,:,:), GTT(:,:,:)

        
        ! Local
        Integer ::  ns
        Complex  (Kind=Kind(0.d0))   ::  G(3,3), G1(3,3,2), Z

        Predefined_Obs_Cotunneling  = cmplx(0.d0,0.d0,kind(0.d0))
        If (N_FL == 1)  then
           G(1,1)  = 1.d0 - GTT(I_f,I_f,1)
           G(1,2)  = -G0T(J_c,I_f,1)
           G(1,3)  = -G0T(J_f,I_f,1)
           G(2,1)  = -GTT(I_f,I_c,1)
           G(2,2)  = -G0T(J_c,I_c,1)
           G(2,3)  = -G0T(J_f,I_c,1)
           G(3,1)  = -GT0(I_f,J_f,1)
           G(3,2)  = -G00(J_c,J_f,1)
           G(3,3)  = 1.d0 - G00(J_f,J_f,1)
           select Case(N_SUN)
           case (2)
              Z =  (32.0*(1.*G(1,1)*G(2,3)*G(3,2) + 1.*G(1,2)*G(2,1)*G(3,3))  + &
                   &    2.0*((-25.*G(1,3)*G(2,2) - 20.*G(1,2)*G(2,3))*G(3,1)  + &
                   &       (-48.*G(1,3)*G(2,1) - 95.*G(1,1)*G(2,3))*G(3,2)    + &
                   &       (-84.*G(1,2)*G(2,1) - 21.5*G(1,1)*G(2,2))*G(3,3))  + &
                   &    8.0*(2*(-4.*G(1,3)*G(2,1) - 10.*G(1,1)*G(2,3))*G(3,2) + &
                   &       (-19.*G(1,2)*G(2,1) - 1.5*G(1,1)*G(2,2))*G(3,3))   + &
                   &    2.0*(9.*(1.*G(1,3)*G(2,2) + 1.*G(1,2)*G(2,3))*G(3,1)  + &
                   &       (9.*G(1,3)*G(2,1) + 21.*G(1,1)*G(2,3))*G(3,2)      + &
                   &       (18.*G(1,2)*G(2,1) + 7.5*G(1,1)*G(2,2))*G(3,3))    + &
                   &    4.0*((5.*G(1,3)*G(2,2) + 4.*G(1,2)*G(2,3))*G(3,1)     + &
                   &       (40.*G(1,3)*G(2,1) + 69.*G(1,1)*G(2,3))*G(3,2)     + &
                   &       (63.*G(1,2)*G(2,1) + 10.*G(1,1)*G(2,2))*G(3,3)))/4.
           case (4)
              Z =  (1024.*(1.*G(1,1)*G(2,3)*G(3,2) + 1.*G(1,2)*G(2,1)*G(3,3))   + &
                   &    4.*((-153.*G(1,3)*G(2,2) - 72.*G(1,2)*G(2,3))*G(3,1)    + &
                   &       (-280.*G(1,3)*G(2,1) - 517.*G(1,1)*G(2,3))*G(3,2)    + &
                   &       (-459.*G(1,2)*G(2,1) - 70.5*G(1,1)*G(2,2))*G(3,3))   + &
                   &    64.*(4.*(-8.*G(1,3)*G(2,1) - 14.*G(1,1)*G(2,3))*G(3,2)  + &
                   &       (-54.*G(1,2)*G(2,1) - 1.5*G(1,1)*G(2,2))*G(3,3))     + &
                   &    16.*((17.*G(1,3)*G(2,2) + 8.*G(1,2)*G(2,3))*G(3,1)      + &
                   &       (248.*G(1,3)*G(2,1) + 273.*G(1,1)*G(2,3))*G(3,2)     + &
                   &       (253.*G(1,2)*G(2,1) + 18.*G(1,1)*G(2,2))*G(3,3))     + &
                   &    4.*(25.*(1.*G(1,3)*G(2,2) + 1.*G(1,2)*G(2,3))*G(3,1)    + &
                   &       (25.*G(1,3)*G(2,1) + 65.*G(1,1)*G(2,3))*G(3,2)       + &
                   &       (55.*G(1,2)*G(2,1) + 22.5*G(1,1)*G(2,2))*G(3,3)))/16.
           case (6)
              Z = (7776.*(1.*G(1,1)*G(2,3)*G(3,2) + 1.*G(1,2)*G(2,1)*G(3,3))    + &
                   &    6.*((-481.*G(1,3)*G(2,2) - 156.*G(1,2)*G(2,3))*G(3,1)   + &
                   &       (-840.*G(1,3)*G(2,1) - 1507.*G(1,1)*G(2,3))*G(3,2)   + &
                   &       (-1342.*G(1,2)*G(2,1) - 147.5*G(1,1)*G(2,2))*G(3,3)) + &
                   &    216.*(6*(-12.*G(1,3)*G(2,1) - 18.*G(1,1)*G(2,3))*G(3,2) + &
                   &       (-105.*G(1,2)*G(2,1) - 1.5*G(1,1)*G(2,2))*G(3,3))    + &
                   &    36.*((37.*G(1,3)*G(2,2) + 12.*G(1,2)*G(2,3))*G(3,1)     + &
                   &       (768.*G(1,3)*G(2,1) + 661.*G(1,1)*G(2,3))*G(3,2)     + &
                   &       (619.*G(1,2)*G(2,1) + 26.*G(1,1)*G(2,2))*G(3,3))     + &
                   &    6.*(49.*(1.*G(1,3)*G(2,2) + 1.*G(1,2)*G(2,3))*G(3,1)    + &
                   &       (49.*G(1,3)*G(2,1) + 133.*G(1,1)*G(2,3))*G(3,2)      + &
                   &       (112.*G(1,2)*G(2,1) + 45.5*G(1,1)*G(2,2))*G(3,3)))/36.
           case (8)
              Z = (32768*(1.*G(1,1)*G(2,3)*G(3,2) + 1.*G(1,2)*G(2,1)*G(3,3))    + &
                   &    8*((-1105.*G(1,3)*G(2,2) - 272.*G(1,2)*G(2,3))*G(3,1)   + &
                   &       (-1872.*G(1,3)*G(2,1) - 3305.*G(1,1)*G(2,3))*G(3,2)  + &
                   &       (-2949.*G(1,2)*G(2,1) - 252.5*G(1,1)*G(2,2))*G(3,3)) + &
                   &    512*(8*(-16.*G(1,3)*G(2,1) - 22.*G(1,1)*G(2,3))*G(3,2)  + &
                   &       (-172.*G(1,2)*G(2,1) - 1.5*G(1,1)*G(2,2))*G(3,3))    + &
                   &    64*((65.*G(1,3)*G(2,2) + 16.*G(1,2)*G(2,3))*G(3,1)      + &
                   &       (1744.*G(1,3)*G(2,1) + 1281.*G(1,1)*G(2,3))*G(3,2)   + &
                   &       (1209.*G(1,2)*G(2,1) + 34.*G(1,1)*G(2,2))*G(3,3))    + &
                   &    8*(81.*(1.*G(1,3)*G(2,2) + 1.*G(1,2)*G(2,3))*G(3,1)     + &
                   &       (81.*G(1,3)*G(2,1) + 225.*G(1,1)*G(2,3))*G(3,2)      + &
                   &       (189.*G(1,2)*G(2,1) + 76.5*G(1,1)*G(2,2))*G(3,3)))/64. 
           case default
              Write(error_unit,*) 'Cotunneling, N_SUN=', N_SUN, 'is not yet implemented'
              CALL Terminate_on_error(ERROR_MISSING_OBS,__FILE__,__LINE__)
           end select
           Predefined_Obs_Cotunneling  = Z
           
        elseif (N_FL == 2 )   then  !  This works only for N_SUN = 1 
           do  ns = 1,2
              G1(1,1,ns)  = 1.d0 - GTT(I_f,I_f,ns)
              G1(1,2,ns)  = -G0T(J_c,I_f,ns)
              G1(1,3,ns)  = -G0T(J_f,I_f,ns)
              G1(2,1,ns)  = -GTT(I_f,I_c,ns)
              G1(2,2,ns)  = -G0T(J_c,I_c,ns)
              G1(2,3,ns)  = -G0T(J_f,I_c,ns)
              G1(3,1,ns)  = -GT0(I_f,J_f,ns)
              G1(3,2,ns)  = -G00(J_c,J_f,ns)
              G1(3,3,ns)  = 1.d0 - G00(J_f,J_f,ns)
           enddo
           Z =    1.*(-(G1(1,3,2)*G1(2,2,1)*G1(3,1,1)) + G1(1,3,2)*G1(2,1,1)*G1(3,2,1))    - &
                &  0.5*(G1(1,2,1)*G1(2,3,2)*G1(3,1,1) - G1(1,1,1)*G1(2,3,2)*G1(3,2,1))     + &
                &  0.5*(G1(1,3,2)*G1(2,1,2)*G1(3,2,1) - G1(1,1,2)*G1(2,3,2)*G1(3,2,1))     + &
                &  1.*(-(G1(1,3,1)*G1(2,2,2)*G1(3,1,2)) + G1(1,3,1)*G1(2,1,2)*G1(3,2,2))   + &
                &   0.5*(G1(1,3,1)*G1(2,1,1)*G1(3,2,2) - G1(1,1,1)*G1(2,3,1)*G1(3,2,2))    - &
                &  0.5*(G1(1,2,2)*G1(2,3,1)*G1(3,1,2) - G1(1,1,2)*G1(2,3,1)*G1(3,2,2))     - &
                &   0.5*(G1(1,2,2)*G1(2,3,1)*G1(3,1,1) - G1(1,2,2)*G1(2,1,1)*G1(3,3,1))    + &
                &  0.5*(G1(1,3,1)*G1(2,1,2)*G1(3,2,1) - G1(1,2,1)*G1(2,1,2)*G1(3,3,1))     + &
                &  0.25*(-(G1(1,3,1)*G1(2,2,1)*G1(3,1,1)) + G1(1,2,1)*G1(2,3,1)*G1(3,1,1)  + &
                &     G1(1,3,1)*G1(2,1,1)*G1(3,2,1) - G1(1,1,1)*G1(2,3,1)*G1(3,2,1)        - &
                &     G1(1,2,1)*G1(2,1,1)*G1(3,3,1) + G1(1,1,1)*G1(2,2,1)*G1(3,3,1))       - &
                &  0.25*(-(G1(1,1,2)*G1(2,3,1)*G1(3,2,1)) + G1(1,1,2)*G1(2,2,1)*G1(3,3,1)) + &
                &  0.25*(-(G1(1,3,1)*G1(2,2,2)*G1(3,1,1)) + G1(1,1,1)*G1(2,2,2)*G1(3,3,1)) - &
                &  0.25*(-(G1(1,2,2)*G1(2,1,2)*G1(3,3,1)) + G1(1,1,2)*G1(2,2,2)*G1(3,3,1)) + &
                &  0.5*(G1(1,3,2)*G1(2,1,1)*G1(3,2,2) - G1(1,2,2)*G1(2,1,1)*G1(3,3,2))     - &
                &  0.5*(G1(1,2,1)*G1(2,3,2)*G1(3,1,2) - G1(1,2,1)*G1(2,1,2)*G1(3,3,2))     - &
                &  0.25*(-(G1(1,2,1)*G1(2,1,1)*G1(3,3,2)) + G1(1,1,1)*G1(2,2,1)*G1(3,3,2)) + &
                &   0.25*(-(G1(1,3,2)*G1(2,2,1)*G1(3,1,2)) + G1(1,1,2)*G1(2,2,1)*G1(3,3,2))- &
                &  0.25*(-(G1(1,1,1)*G1(2,3,2)*G1(3,2,2)) + G1(1,1,1)*G1(2,2,2)*G1(3,3,2)) + &
                &  0.25*(-(G1(1,3,2)*G1(2,2,2)*G1(3,1,2)) + G1(1,2,2)*G1(2,3,2)*G1(3,1,2)  + &
                &     G1(1,3,2)*G1(2,1,2)*G1(3,2,2) - G1(1,1,2)*G1(2,3,2)*G1(3,2,2)        - &
                &     G1(1,2,2)*G1(2,1,2)*G1(3,3,2) + G1(1,1,2)*G1(2,2,2)*G1(3,3,2))
           Predefined_Obs_Cotunneling  = Z
        endif
 
      end function Predefined_Obs_Cotunneling
