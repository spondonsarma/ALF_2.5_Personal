% !TEX root = Doc.tex
\section{File structure}\label{sec:files}
%
\begin{table}[h]
   \begin{tabular}{l l}
   Directory & Description \\\hline
   \texttt{Prog/} & Main program and subroutines  \\
  \texttt{Libraries/} & Collection of mathematical routines \\  
  \texttt{Analysis/} & Routines for error analysis \\
  \mycomment{\texttt{Examples/}} & Example simulations for Hubbard-type models \mycomment{I suggest to rename it}\\
  \mycomment{\texttt{Start/}}   & Parameter files and scripts \mycomment{I suggest to move it  here} \\
  \mycomment{\texttt{Documentation/}} & Documentation of the QMC code. \\
%   \texttt{configure.sh} & sets the global variables for compilation \\
   \end{tabular}
   \caption{Overview of the directories. 
   \mycomment{We should rename \texttt{Test\_Hub\_Template/}. Just \texttt{Examples/}? This gives us flexibility to include more examples not limited to the Hubbard interaction.
   Then we could have \texttt{Examples/Hubbard\_SU2\_Square}, \texttt{Examples/Hubbard\_Mz\_Square}, \texttt{Examples/Hubbard\_SU2\_Honeycomb}, and \texttt{Examples/Hubbard\_Ising\_Square}
}
   \label{table:files}}
\end{table}
%
The code package consists of the program directories \texttt{Prog/} and \texttt{Libraries/}, 
the analysis routines in \texttt{Analysis/} and \texttt{Test\_Hub\_Template/}, which includes test simulations of the Hubbard model (see table~\ref{table:files}).
%
\subsection{Input files}\label{sec:input}
%
\begin{table}[h]
   \begin{tabular}{l l}
   File & Description \\\hline
  \texttt{parameters} &  Sets the parameters for lattice, model, QMC process, and the error analysis.\\
  \texttt{seeds} & List of integer numbers to initialize the random number generator and \\
   & to start a simulation from scratch.\\
  \texttt{confin\_<thread number>} & Input files for the HS and Ising configuration, used to continue a simulation. 
   \end{tabular}
   \caption{Overview of the input files in \texttt{Test\_Hub\_Template/Start/} required for a simulation. \label{table:input}}
\end{table}
%
The input files are listed in table~\ref{table:input}. 
The parameter file \texttt{Test\_Hub\_Template/Start/parameters} has the following form, 
using as an example  the $SU(2)$-symmetric Hubbard model on a square lattice (see Sec.~\ref{sec:walk1} for a detailed walkthrough):
%
\begin{lstlisting} 
===============================================================================
!  Variables for the Hubb program
!-------------------------------------------------------------------------------
&VAR_lattice
L1 = 4                    ! Length in direction a_1
L2 = 4                    ! Length in direction a_2
Lattice_type = "Square"	  ! a_1 = (1,0),  a_2=(0,1),  Norb = 1
! Lattice_type ="Honeycomb" !   a_1 = (1,0),  a_2 =(1/2,sqrt(3)/2), Norb = 2
Model = "Hubbard_SU2"     ! Sets Nf = 1, N_sun = 2
! Model = "Hubbard_Mz"     ! alternatively: set Nf = 2, N_sun = 1
/
&VAR_Hubbard              ! Variables for the Hubbard model
ham_T   = 1.D0            ! Hopping parameter
ham_chem= 0.D0            ! chemical potential
ham_U   = 4.D0            ! Hubbard interaction
Beta    = 5.D0            ! inverse temperature
dtau    = 0.1D0           ! Thereby Ltrot=Beta/dtau
/
&VAR_QMC                  ! Variables for the QMC run
Nwrap   = 10              ! Stabilization. Green functions will be computed from scratch 
                          ! after each time interval  Nwrap*Dtau
NSweep  = 500             ! Number of sweeps
NBin    = 2               ! Number of bins
Ltau    = 1               ! 1 for calculation of time desplaced Green functions. 0 otherwise
LOBS_ST = 1               ! Start measurments at time slice LOBS_ST
LOBS_EN = 50              ! End   measurments at time slice LOBS_EN
CPU_MAX = 0.1             ! Code will stop after CPU_MAX hours. 
                          ! If not specified, code will stop after Nbin bins.
/                          
&VAR_errors               ! Variables for analysis programs
n_skip  = 1               ! Number of bins that will be skipped. 
N_rebin = 1               ! Rebinning  
N_Cov   = 0               ! If set to 1 covariance will be computed
                          ! for unequal time correlation functions.                   
/            
\end{lstlisting}
%

\subsection{Output files} \label{sec:output}
%
\begin{table}[h]
   \begin{tabular}{l l}
   File & Description \\\hline
   \texttt{info} & After completion of the simulation, this file documents parameters of the  model,\\
   & the QMC run and simulation metrics (precision, acceptance rate, CPU time).\\
   \texttt{X\_scal} & Results of equal-time measurements of scalar observables. \\
   & The placeholder \texttt{X} stands for the observables \texttt{Kin, Pot, Part}, and \texttt{Ener}. \\
   \texttt{X\_eq, X\_tau} & Results of equal-time and time-displaced measurements of correlation functions. \\
   & The placeholder \texttt{X} stands for \texttt{Green, SpinZ, SpinXY}, and \texttt{Den}. \\   
   \texttt{confout\_<thread number>} & Output files for the HS and Ising configuration. 
   \end{tabular}
   \caption{Overview of the standard output files. 
  See Sec.~\ref{sec:obs} for the definitions of observables and correlation functions. \label{table:output}}
\end{table}
%
The output of the measured data is organized in bins. One bin corresponds to the geometric average over a fixed number of individual measurements which depends 
on the chosen measurement interval \texttt{[LOBS\_ST,LOBS\_EN]} on the imaginary time axis and on the number \texttt{NSweep} of Monte Carlo sweeps. If the user run a parallelized version of the code, the average also extends 
over the number of MPI threads. 
The standard output files are listed in table~\ref{table:output}. 

The formatting of the output for a single bin depends on the observable type: \texttt{Obs\_vec} or \texttt{Obs\_Latt}.
\begin{itemize}
\item Observables of type \texttt{Obs\_vec}:
For each additional bin, a single new line is added to the output file.
In case of an observable with \texttt{N\_size} components, the formatting is 
\begin{verbatim}
N_size + 1    <measured value, 1> ... <measured value, N_size>    <measured phase>
\end{verbatim}
The counter variable \texttt{N\_size+1} refers to the number of measurements per line, including the phase measurement. 
This format is required by the error analysis routine (see Sec.~\ref{sec:analysis}). 
Scalar observables like kinetic energy, potential energy, total energy and particle number are treated as a vector 
of size \texttt{N\_size=1}.

\item Observables of type \texttt{Obs\_Latt}:
For each additional bin, a new data block is added to the output file. 
The block consists of the expectation values [Eq.~(\ref{eqn:o})] contributing to the background part [Eq.~(\ref{eqn:s_back})] of the correlation function,
and the correlated part [Eq.~(\ref{eqn:s_corr})] of the correlation function.
For imaginary-time displaced correlation functions, the formatting of the block follows this scheme:
\begin{alltt}
<measured phase>  <N_orbital>  <N_unit_cell> <N_time_slices> <dtau>
do alpha = 1, N_orbital
    \(\langle\hat{O}\sb{\alpha}\rangle \)
enddo
do i = 1, N_unit_cell
   <reciprocal lattice vector k(i)>
   do tau = 1, N_time_slices
      do alpha = 1, N_orbital
         do beta = 1, N_orbital
            \(\langle\,S\sb{\alpha,\beta}\sp{(corr)}(k(i),\tau)\rangle\)
         enddo
      enddo
   enddo
enddo
\end{alltt}
The same block structure is used for equal-time correlation functions, except for the entries  \texttt{<N\_time\_slices>} and \texttt{<dtau>} 
which are not present in the latter.
Using this structure for the bins as input,
the full correlation function $S_{\alpha,\beta}(\vec{k},\tau)$ [Eq.~(\ref{eqn:s})] is then calculated by calling the error analyis routine [see Sec.~(\ref{})].
\end{itemize}

\subsection{Scripts}\label{sec:scripts}
%
\begin{table}[h]
   \begin{tabular}{l l l}
   Script & Description & Section\\\hline
   \texttt{set\_env.sh} & Sets the environment variables for the compiler& \\
   & and the libraries. & \ref{sec:running}\\
   \mycomment{\texttt{Start/out\_to\_in.sh}} & Copies the output configurations of HS and Ising spins &\\
   & to the respective input files. & \ref{sec:running} \\
   \mycomment{\texttt{Start/analysis.sh}} & Starts the error analysis. & \ref{sec:analysis}
   \end{tabular}
   \caption{Overview of the bash script files. 
   \mycomment{MB I have renamed the scripts here, but not yet in the git}
   \label{table:scripts}}
\end{table}
%
