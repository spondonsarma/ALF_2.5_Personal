% !TEX root = Doc.tex
\section{File structure}\label{sec:files}
%
\begin{table}[h]
   \begin{tabular}{l l}
   Directory & Description \\\hline
   \texttt{Prog/} & Main program and subroutines  \\
  \texttt{Libraries/} & Collection of mathematical routines \\  
  \texttt{Analysis/} & Routines for error analysis \\
  \texttt{Test\_Hub\_Template/} & Test simulations of the Hubbard model\\
  \texttt{Documentation/} & \mycomment{to include}\\
%   \texttt{configure.sh} & sets the global variables for compilation \\
   \end{tabular}
   \caption{Overview of the directories. \label{table:files}}
\end{table}
%
The code package consists of the program directories \texttt{Prog/} and \texttt{Libraries/}, 
the analysis routines in \texttt{Analysis/} and \texttt{Test\_Hub\_Template/}, which includes test simulations of the Hubbard model (see table~\ref{table:files}).
%
\subsection{Input files}\label{sec:input}
%
\begin{table}[h]
   \begin{tabular}{l l}
   File & Description \\\hline
  \texttt{parameters} &  Sets the parameters for lattice, model and the QMC process.\\
  \texttt{seeds} & List of integer numbers to initialize the random number generator and \\
   & to start a simulation from scratch.\\
  \texttt{confin\_<thread number>} & Input files for the HS and Ising configuration, used to continue a simulation. 
   \end{tabular}
   \caption{Overview of the input files in \texttt{Test\_Hub\_Template/Start/} required for a simulation. \label{table:input}}
\end{table}
%
The input files are listed in table~\ref{table:input}. 
The parameter file \texttt{Test\_Hub\_Template/Start/parameters} has the following form, 
using as an example  the $SU(2)$-symmetric Hubbard model on a square lattice (see Sec.~\ref{sec:walk1} for a detailed walkthrough):
%
\begin{lstlisting} 
===============================================================================
!  Variables for the Hubb program
!-------------------------------------------------------------------------------
&VAR_lattice
L1 = 4                    ! Length in direction a_1
L2 = 4                    ! Length in direction a_2
Lattice_type = "Square"	  ! a_1 = (1,0),  a_2=(0,1),  Norb = 1
! Lattice_type ="Honeycomb" !   a_1 = (1,0),  a_2 =(1/2,sqrt(3)/2), Norb = 2
Model = "Hubbard_SU2"     ! Sets Nf = 1, N_sun = 2
! Model = "Hubbard_Mz"     ! alternatively: set Nf = 2, N_sun = 1
/
&VAR_Hubbard              ! Variables for the Hubbard model
ham_T   = 1.D0            ! Hopping parameter
ham_chem= 0.D0            ! chemical potential
ham_U   = 4.D0            ! Hubbard interaction
Beta    = 5.D0            ! inverse temperature
dtau    = 0.1D0           ! Thereby Ltrot=Beta/dtau
/
&VAR_QMC                  ! Variables for the QMC run
Nwrap   = 10              ! Stabilization. Green functions will be computed from scratch 
                          ! after each time interval  Nwrap*Dtau
NSweep  = 500             ! Number of sweeps
NBin    = 2               ! Number of bins
Ltau    = 1               ! 1 for calculation of time desplaced Green functions. 0 otherwise
LOBS_ST = 1               ! Start measurments at time slice LOBS_ST
LOBS_EN = 50              ! End   measurments at time slice LOBS_EN
CPU_MAX = 0.1             ! Code will stop after CPU_MAX hours. 
                          ! If not specified, code will stop after Nbin bins.
/                          
&VAR_errors               ! Variables for analysis programs
n_skip  = 1               ! Number of bins that will be skipped
N_rebin = 1               ! Rebinning                    
/            
\end{lstlisting}
%

\subsection{Output files} \label{sec:output}
%
\begin{table}[h]
   \begin{tabular}{l l}
   File & Description \\\hline
   \texttt{info} & After completion of the simulation, this file documents parameters of the  model, the QMC run, \\
   & and simulation metrics (precision, acceptance rate, CPU time).\\
   \texttt{X\_scal} & Results of equal-time measurements of scalar observables. \\
   & The placeholder \texttt{X} stands for the observables \texttt{Kin, Pot, Part}, and \texttt{Ener}. \\
   \texttt{X\_eq, X\_tau} & Results of equal-time and time-displaced measurements of correlation functions. \\
   & The placeholder \texttt{X} stands for \texttt{Green, SpinZ, SpinXY}, and \texttt{Den}. \\   
   \texttt{confout\_<thread number>} & Output files for the HS and Ising configuration. 
   \end{tabular}
   \caption{Overview of the standard output files. 
  See Sec.~\ref{sec:obs} for the definitions of observables and correlation functions. \label{table:output}}
\end{table}
%
The output of the measured data is organized in bins. One bin corresponds to the geometric average over a fixed number of individual measurements which depends 
on the chosen measurement interval \texttt{[LOBS\_ST,LOBS\_EN]} on the imaginary time axis and on the number \texttt{NSweep} of Monte Carlo sweeps. If the user run a parallelized version of the code, the average also extends 
over the number of MPI threads. 
The standard output files are listed in table~\ref{table:output}. 

The formatting of the output for a single bin depends on the observable type: \texttt{Obs\_vec} or \texttt{Obs\_Latt}.
\begin{itemize}
\item Observables of type \texttt{Obs\_vec}:
For each additional bin, a single new line is added to the output file.
In case of an observable with \texttt{N\_size} components, the formatting is 
\begin{verbatim}
N_size + 1    <measured value, 1> ... <measured value, N_size>    <measured phase>
\end{verbatim}
The counter variable \texttt{N\_size+1} refers to the number of measurements per line, including the phase measurement. 
This format is required by the error analysis routine (see Sec.~\ref{sec:analysis}). 
\mycomment{Mention an example of a vector observable?}
Scalar observables like kinetic energy, potential energy, total energy and particle number are treated as a vector 
of size \texttt{N\_size=1}.

\item Observables of type \texttt{Obs\_Latt}:
For each additional bin, a new data block is added to the output file. 
The block consists of the background part and the correlated part of the correlation function.
For the imaginary-time displace correlation function, the formatting of this block follows this scheme:
\begin{verbatim}
<measured phase>  <N_orbital>  <N_unit_cell> <N_time_slices> <dtau>
do m = 1, N_orbital
   <background part of orbital m>
enddo
do i = 1, N_unit_cell
   <reciprocal lattice vector k(i)>
   do t = 1, N_time_slices
      do m = 1, N_orbital
         do n = 1, N_orbital
            <correlated part at vector k(i), time t, and orbitals m,n>
         enddo
      enddo
   enddo
enddo
\end{verbatim}
The same block structure for each bin is used for equal-time correlation functions, except for the entries  \texttt{<N\_time\_slices>} and \texttt{<dtau>}.
\mycomment{It seems that right now, to get the full correlation function including the background one has to write a script?}
\FAcomment{FA: I do not understand this. This will be produced by the analysis  programs... I guess that you have something else in mind....}

\end{itemize}

\subsection{Scripts}\label{sec:scripts}
%
\begin{table}[h]
   \begin{tabular}{l l}
   Script & Description \\\hline
   \texttt{configure.sh} & To sets the environment variables for the compiler and the libraries.\\
   \texttt{Test\_Hub\_Template/Start/out\_to\_in.c} & To copy the output configurations of HS and Ising spins\\
   & to the respective input files. \\
   \texttt{Test\_Hub\_Template/Start/analysis.c} & To perform the error analysis.
   \end{tabular}
   \caption{Overview of the bash script files. \label{table:scripts}}
\end{table}
%
