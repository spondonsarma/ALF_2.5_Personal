% !TeX document-id = {2fc16d90-fe07-4ec8-91d5-5acebdd2ee85}
% !BIB TS-program = bibtex

% Copyright (c) 2016-2022 The ALF project.
% This is the ALF project documentation.
% The ALF project documentation by the ALF contributors is licensed
% under a Creative Commons Attribution-ShareAlike 4.0 International License.
% For the licensing details of the documentation see license.CCBYSA.

\documentclass[submission, PhysCodeb]{SciPost}
\pdfoutput=1
\usepackage{lineno}
\usepackage{graphicx}
\graphicspath{{./Figures/}{./Figures/Kondo/}{./Figures/MaxEnt/}{./Figures/MaxEnt/}{./Figures/Projector/}{./Figures/PAM/}{./Figures/Dtau/}{./Figures/Dtau_1/}}
\usepackage[T1]{fontenc}
\usepackage{lmodern}

\usepackage{bbm}
\newcommand{\bmmax}{1}
\newcommand{\hmmax}{1}
\usepackage{amsmath,mathtools} % multilined
%%\usepackage{amssymb}
\usepackage{wasysym}
\usepackage{color}
\usepackage{xcolor}
\usepackage{tcolorbox}
\usepackage{soul}
\usepackage{multirow}
\usepackage{xspace}
\usepackage{bm}
\usepackage{dsfont}
\usepackage[htt]{hyphenat}
\usepackage{footnote}
\usepackage{cite}
\usepackage{alltt}
\usepackage{listings}
\usepackage{enumitem}
\usepackage{algorithm}
\usepackage{algcompatible}
\usepackage{algpseudocode}
\usepackage{url}
\usepackage{booktabs}
\hypersetup{breaklinks=true, colorlinks, pdfborder={0 0 0}, linkcolor={red!50!black}, citecolor={blue!50!black}, urlcolor={blue!80!black}}
\usepackage{float} 
\usepackage{placeins}
\usepackage{makeidx}
\usepackage[xindy]{imakeidx}
\usepackage[framemethod=default]{mdframed}
\usepackage{showexpl}
\usepackage{etoolbox}
\usepackage{calc}
\usepackage{dirtree}
\usepackage[bitstream-charter]{mathdesign}
\urlstyle{sf}

% Fix \cal and \mathcal characters look (so it's not the same as \mathscr)
\DeclareSymbolFont{usualmathcal}{OMS}{cmsy}{m}{n}
\DeclareSymbolFontAlphabet{\mathcal}{usualmathcal}


% Prevent all line breaks in inline equations.
\binoppenalty=10000
\relpenalty=10000

\makeatletter
\renewcommand\paragraph{\@startsection{paragraph}{4}{\z@}%
            {-2.5ex\@plus -1ex \@minus -.25ex}%
            {1.25ex \@plus .25ex}%
            {\normalfont\normalsize\bfseries}}
\makeatother
\makeatletter
\newcommand{\vast}{\bBigg@{3}}
\newcommand{\Vast}{\bBigg@{4}}
\newcommand{\VAST}{\bBigg@{5}}
\makeatother

\setcounter{secnumdepth}{4} 
\setcounter{tocdepth}{4}
\definecolor{light-gray}{gray}{0.95}
\definecolor{light-gray2}{gray}{0.88}
\definecolor{comment-color}{rgb}{0.8,0.1,0.1}
\definecolor{keyword-color}{rgb}{0.3,0.3,1}
\sethlcolor{light-gray2}
\newcommand*{\red}{\textcolor{red}}
\newcommand*{\blue}{\textcolor{blue}}


\lstdefinestyle{fortran}{
  language={[03]Fortran},
  basicstyle=\ttfamily\footnotesize,
  keywordstyle=\color{keyword-color},
  commentstyle=\color{comment-color},
  morecomment=[l]{!\ },% Otherwise it's a comment only with space after !
  breakatwhitespace=false,
  keepspaces=true,
  showstringspaces=false,
  columns=fullflexible,
  backgroundcolor=\color{light-gray},
  frame=single,
  xleftmargin=3.4pt,
  xrightmargin=3.4pt
}

\lstdefinestyle{fortran_pseudo_code}{
  language={[03]Fortran},
  basicstyle=\ttfamily\small,
  keywordstyle=\color{red},
  commentstyle=\normalfont\color{black},
  morecomment=[l]{!\ }% Comment only with space after !
  breakatwhitespace=false,
  keepspaces=true,
  showstringspaces=false,
  columns=flexible,
  backgroundcolor=\color{white},
  frame=single,
  xleftmargin=3.4pt,
  xrightmargin=3.4pt,
  escapeinside={\!*}{*)},
}

\lstdefinestyle{bash}{
  language=bash,
  basicstyle=\ttfamily,
  keywordstyle=\color{keyword-color},
  commentstyle=\color{comment-color},
  morecomment=[l]{\#\ }% Comment only with space after #
  breakatwhitespace=false,
  keepspaces=true,
  showstringspaces=false,
  columns=flexible,
  xleftmargin=3.4pt,
  xrightmargin=3.4pt,
}

\newcommand{\ALFver}{2.5}           %{dev.} version of ALF this document refers to
\newcommand{\ALFbranch}{ALF-2.5}    %{ALF-2.2}{master} corresponding ALF branch
\newcommand{\pyALFver}{2.5}         %{dev.} version of pyALF that works with \ALFver
\newcommand{\pyALFbranch}{ALF-2.5}  %{ALF-2.2}{master} corresponding pyALF branch
\newcommand{\tutALFver}{2.5}        %{dev} version of the tutorial - normally should be the same as \ALFver (ex.: 2.2, dev [NO PERIOD AFTER "DEV", SINCE IT'S ALSO USED IN PATHS])

\def\Tr{\mathop{\mathrm{Tr}}}
\def\Trf{\mathop{\mathrm{Tr}_{\mathrm{F}}}}
\def\d{\mathrm{d}}
\def\hc{\mathrm{H.c.}}
\DeclareMathOperator{\sgn}{sgn}
\makesavenoteenv{tabular}
\makesavenoteenv{table}

\renewcommand{\Re}{\operatorname{Re}}
\renewcommand{\Im}{\operatorname{Im}}
\renewcommand{\vec}[1]{\boldsymbol{#1}}
\newcommand{\ve}[1]{\boldsymbol{#1}}
\newcommand{\tl}{t_{l}}
\newcommand{\ts}{\underline{t}}
\newcommand{\Ztwo}{\mathbf{Z}_{2}}

%------------------------ algpseudocode additions -----------------------------------

\algrenewcommand\algorithmiccomment[1]{\hfill \textcolor{comment-color}{\small  $\triangleright$ \textit{#1}}}
\algrenewcommand\alglinenumber[1]{\scriptsize #1:}

%\algnewcommand{\IIf}[1]{\State\algorithmicif\ #1\ \algorithmicthen} % https://tex.stackexchange.com/a/184228/105662
%\algnewcommand{\IElse}[1]{\State\algorithmicelse\ #1 }
%\algnewcommand{\EndIIf}{\unskip\ \algorithmicend\ \algorithmicif}

\makeatletter % Based on  https://tex.stackexchange.com/a/169608/105662
\newlength{\trianglerightwidth}
\settowidth{\trianglerightwidth}{$\triangleright$~}
\algnewcommand{\LineComment}[1]{\Statex \hskip\ALG@thistlm%
	\parbox[t]{\dimexpr\linewidth-\ALG@thistlm}{\hangindent=\trianglerightwidth \hangafter=1 \strut\textcolor{comment-color}{\small $\triangleright$ \textit{#1}}\strut}}
% If comment line is the first of a block:
\algnewcommand{\FirstLineComment}[1]{\Statex \hskip\ALG@thistlm%
	\parbox[t]{\dimexpr\linewidth-\ALG@thistlm}{\hangindent=\dimexpr\algorithmicindent+\trianglerightwidth \hangafter=1 \strut\makebox[\algorithmicindent][l]{}\textcolor{comment-color}{\small $\triangleright$ \textit{#1}}\strut}}
\makeatother

\makeatletter % https://tex.stackexchange.com/a/428081/105662
\newenvironment{breakablealgorithm}
{% \begin{breakablealgorithm}
	\begin{center}
		\refstepcounter{algorithm}% New algorithm
		\hrule height.8pt depth0pt \kern2pt% \@fs@pre for \@fs@ruled
		\renewcommand{\caption}[2][\relax]{% Make a new \caption
			{\raggedright\textbf{\ALG@name~\thealgorithm} ##2\par}%
			\ifx\relax##1\relax % #1 is \relax
			\addcontentsline{loa}{algorithm}{\protect\numberline{\thealgorithm}##2}%
			\else % #1 is not \relax
			\addcontentsline{loa}{algorithm}{\protect\numberline{\thealgorithm}##1}%
			\fi
			\kern2pt\hrule\kern2pt
		}
	}{% \end{breakablealgorithm}
		\kern2pt\hrule\relax% \@fs@post for \@fs@ruled
	\end{center}
}
\makeatother

% vertical rules for blocks: None of the solutions found work with all of the: page breaks, redefined comments and added vertical spaces. The solution at  https://tex.stackexchange.com/a/351363/105662  and the 1st solution at  https://tex.stackexchange.com/a/147751/105662  appear to break the least, but vertical rules are full of gaps at those special spots.

%------------------------------------------------------------------------------------


\makeindex

\begin{document}
	
% Title
\begin{center}{\Large \textbf{
The \emph{ALF} (\emph{A}lgorithms for \emph{L}attice \emph{F}ermions)\\project release \ALFver\\
{\normalsize Documentation for the  auxiliary-field quantum Monte Carlo code}
}}\end{center}

% Author list
\begin{center}
The \textbf{ALF Collaboration\textsuperscript{$\star$}}:
F.~F.~Assaad\textsuperscript{1,4},
M.~Bercx\textsuperscript{1},
F.~Goth\textsuperscript{1},
A.~G\"otz\textsuperscript{1},
J.~S.~Hofmann\textsuperscript{2},
E.~Huffman\textsuperscript{3},
Z.~Liu\textsuperscript{1},
F.~Parisen~Toldin\textsuperscript{1},
J.~S.~E.~Portela\textsuperscript{1},
J.~Schwab\textsuperscript{1}
\end{center}

% Affiliation
\begin{center}
{\bf 1} Institut f\"ur Theoretische Physik und Astrophysik, Universit\"at W\"urzburg,\\
97074 W\"urzburg, Germany\\
{\bf 2} Department of Condensed Matter Physics, Weizmann Institute of Science,\\
Rehovot, 76100, Israel\\
{\bf 3} Perimeter Institute for Theoretical Physics,\\
Waterloo, Ontario N2L 2Y5, Canada\\
{\bf 4} W\"urzburg-Dresden Cluster of Excellence ct.qmat, \\ Am Hubland, 97074 W\"urzburg, Germany

${}^\star$\href{mailto:alf@physik.uni-wuerzburg.de}{\small \sf alf@physik.uni-wuerzburg.de}
\end{center}

\begin{center}
\today
\end{center}

% For convenience during refereeing: line numbers
%\linenumbers

\section*{Abstract}
{\bf
The \emph{Algorithms for Lattice Fermions} package provides a general code for the finite-temperature and projective auxiliary-field quantum Monte Carlo algorithm. The code is engineered to be able to simulate any model that can be written in terms of sums of single-body operators, of squares of single-body operators and single-body operators coupled to a bosonic field with given dynamics.   The package includes five pre-defined model classes:  SU(N) Kondo, SU(N) Hubbard, SU(N) t-V and SU(N) models with long range Coulomb repulsion on honeycomb, square and N-leg lattices, as well as $\Ztwo$  unconstrained lattice gauge theories coupled to fermionic and $\Ztwo$ matter. An implementation of the stochastic  Maximum Entropy  method is also provided. 
One can download the code from our Git instance at \url{https://git.physik.uni-wuerzburg.de/ALF/ALF/-/tree/\ALFbranch} and sign in to file issues.} \\

% We provide predefined types that allow the user to specify the model, the Bravais lattice as well as equal-time and time-displaced observables. The code supports an MPI implementation. Examples such as the Hubbard model on the honeycomb lattice and the Hubbard model on the square lattice coupled to a transverse Ising field are provided and discussed in the documentation. We furthermore discuss how to use the package to implement the Kondo lattice model and the SU(N)-Hubbard-Heisenberg model. }\\

%\noindent Copyright \textcopyright ~2016--2022 The \textit{ALF} Project.\\
%This is the ALF Project Documentation. % by the ALF contributors.
%It is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.
%You are free to share and benefit from this documentation as long as this license is preserved
%and proper attribution to the authors is given. For details see the ALF project
%website \url{https://alf.physik.uni-wuerzburg.de}.

\vspace{10pt}
\noindent\rule{\textwidth}{1pt}
\tableofcontents\thispagestyle{fancy}
\noindent\rule{\textwidth}{1pt}
\vspace{10pt}

%\clearpage
\section{Introduction}\label{sec:intro}
\input{intro}
\section{Auxiliary Field Quantum Monte Carlo: finite temperature}\label{sec:def}
\input{model}
\input{updating}
\input{langevin}
\input{stabilization}
\section{Auxiliary Field Quantum Monte Carlo: projective algorithm}\label{sec:defT0}
\input{pqmc}
\section{Monte Carlo sampling}\label{sec:sampling}
\input{sampling}
\section{Data Structures and Input/Output}\label{sec:imp}
\input{implementation}
\input{files}
\section{Using the Code}\label{sec:running}
\input{running}
\section{The plain vanilla Hubbard model on the square lattice} \label{sec:vanilla}
\input{Hubbard_Plain}
\section{Predefined Structures}\label{sec:predefined}
\input{predefined}
\section{Model Classes}\label{sec:model_classes}
\input{Model_classes}
\section{Maximum Entropy}\label{sec:maxent}
\input{maxent}
\section{Conclusions and Future Directions}\label{sec:con}
\input{conclusion}
\addcontentsline{toc}{section}{Acknowledgments}
\input{acknowledgment}
\begin{appendix}
\input{wick}
\input{performance}
\input{license}
\end{appendix}
\bibliography{./fassaad,./doc}
\printindex

\nolinenumbers

\end{document}
